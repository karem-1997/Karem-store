<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        :root {
            --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%);
            --bg: #050505;
            --card-bg: #0d0d0d;
            --text-gold: #fcf6ba;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg);
            color: #fff;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .master-title {
            font-size: 38px;
            font-weight: 900;
            background: var(--gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            margin: 20px 0;
        }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬) */
        .tabs-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 25px;
        }

        .tab-btn {
            background: #1a1a1a;
            color: #888;
            border: 1px solid #333;
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .tab-btn.active {
            background: var(--gold);
            color: #000;
            border-color: transparent;
        }

        /* Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .main-card {
            background: var(--card-bg);
            border: 1px solid rgba(191,149,63,0.3);
            border-radius: 30px;
            padding: 30px;
            width: 100%;
            max-width: 480px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.9);
            display: none;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ§Ø±Øª */
        .card-header { text-align: center; margin-bottom: 20px; }
        .warning-box { color: #ff4d4d; font-size: 13px; font-weight: bold; background: rgba(255,77,77,0.1); padding: 10px; border-radius: 12px; margin: 10px 0; border: 1px solid rgba(255,77,77,0.2); }
        
        .id-copy-area {
            background: rgba(191,149,63,0.05);
            border: 1px dashed #bf953f;
            border-radius: 20px;
            padding: 15px;
            cursor: pointer;
            margin-top: 15px;
        }

        /* Ø§Ù„Ø®Ø§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .input-group { margin-bottom: 18px; text-align: right; }
        label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-gold); font-weight: bold; }
        input, select {
            width: 100%;
            background: #151515;
            border: 1px solid rgba(191,149,63,0.2);
            border-radius: 12px;
            padding: 14px;
            color: white;
            box-sizing: border-box;
            outline: none;
            font-family: 'Tajawal';
        }

        /* ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .calc-box {
            background: linear-gradient(180deg, rgba(191,149,63,0.1) 0%, transparent 100%);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid rgba(191,149,63,0.15);
        }
        .final-price { font-size: 32px; font-weight: 900; color: #fff; margin-top: 5px; }

        .btn-submit {
            width: 100%;
            padding: 18px;
            background: var(--gold);
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 900;
            color: #000;
            cursor: pointer;
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© */
        #adminOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
        }
        .admin-modal {
            background: #0a0a0a;
            border: 2px solid #bf953f;
            border-radius: 30px;
            max-width: 650px;
            margin: auto;
            padding: 30px;
        }
        .admin-section {
            background: #111;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid #222;
        }
        .agent-row { display: grid; grid-template-columns: 2fr 2fr auto; gap: 10px; margin-bottom: 10px; }
        .btn-action { padding: 10px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<h1 class="master-title" onclick="openAdmin()">Helmy Card</h1>

<div class="tabs-container" id="appsNav"></div>

<div class="main-card" id="userInterface">
    <div class="card-header">
        <h2 id="disp_name" style="color:gold; margin:0;"></h2>
        <div id="disp_warn" class="warning-box"></div>
        <div class="id-copy-area" onclick="copyMasterID()">
            <small>ID Ø§Ù„Ø³Ø­Ø¨ (Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø®)</small><br>
            <b id="disp_aid" style="font-size: 22px;"></b><br>
            <small>Ø§Ù„Ù…Ø³ØªÙ„Ù…: <span id="disp_aname"></span></small>
        </div>
    </div>

    <div class="input-group">
        <label id="lbl_uid">Ø§Ù„Ø£ÙŠØ¯ÙŠ</label>
        <input type="text" id="user_id_input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
    </div>

    <div id="pointsSection" style="display: none;">
        <div class="input-group">
            <label id="lbl_points">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·</label>
            <input type="number" id="points_input" placeholder="0" oninput="calculatePrice()">
        </div>
    </div>

    <div class="input-group">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ($)</label>
        <input type="number" id="usd_input" placeholder="0.00" oninput="calculatePrice()">
    </div>

    <div class="input-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</label>
        <select id="method_select" onchange="toggleAgentList(); calculatePrice();">
            <option value="cash">ÙƒØ§Ø´ (ÙÙˆØ¯Ø§ÙÙˆÙ†/Ø§ØªØµØ§Ù„Ø§Øª/Ø£ÙˆØ±Ù†Ø¬)</option>
            <option value="agent_general">Ø³Ø­Ø¨ ÙˆÙƒÙ„Ø§Ø¡ (Ø³Ø¹Ø± Ø¹Ø§Ù…)</option>
            <option value="agent_private">ÙƒÙˆØ¯ ÙˆÙƒÙŠÙ„ Ù…Ø³Ø¬Ù„ (Ø³Ø¹Ø± Ø®Ø§Øµ) ğŸ”½</option>
        </select>
    </div>

    <div class="input-group" id="vipAgentGroup" style="display: none;">
        <label>Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <select id="vip_list" onchange="calculatePrice()"></select>
    </div>

    <div class="calc-box">
        <div id="rate_display" style="font-size: 12px; color: gold;">Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±: 0</div>
        <div class="final-price" id="egp_display">0.00 Ø¬.Ù…</div>
    </div>

    <div class="input-group">
        <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø§Ù„Ø°ÙŠ Ø­ÙˆÙ„Øª Ù…Ù†Ù‡ Ø£Ùˆ ØªØ³ØªÙ„Ù… Ø¹Ù„ÙŠÙ‡)</label>
        <input type="text" id="wallet_input" placeholder="01xxxxxxxxx">
    </div>

    <div class="input-group">
        <label>Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Screenshot)</label>
        <input type="file" id="file_input" accept="image/*">
    </div>

    <button class="btn-submit" onclick="submitFinalOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="adminOverlay">
    <div class="admin-modal">
        <h2 style="text-align:center; color:gold;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h2>
        
        <div class="admin-section" style="border: 1px solid #22c55e;">
            <label style="color:#22c55e;">â• Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯</label>
            <input type="text" id="new_app_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
            <button onclick="createNewSystem()" class="btn-action" style="background:#22c55e; color:#000; width:100%; margin-top:10px;">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¢Ù†</button>
        </div>

        <div id="editZone" style="display:none;">
            <h3 style="color:gold;">ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª: <span id="target_app"></span></h3>
            
            <div class="admin-section">
                <label>ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ù€ API</label>
                <div class="input-group"><label>ØªÙˆÙƒÙ† Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</label><input type="text" id="adm_token"></div>
                <div class="input-group"><label>ID Ø§Ù„Ø´Ø§Øª (Chat ID)</label><input type="text" id="adm_chatid"></div>
                <div class="input-group"><label>Ø±Ø§Ø¨Ø· Google Script (Ø´ÙŠØª Ø§Ù„Ø¥ÙƒØ³Ù„)</label><input type="text" id="adm_sheet"></div>
            </div>

            <div class="admin-section">
                <label>ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„</label>
                <div class="input-group"><label>ØªØ³Ù…ÙŠØ© Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙŠØ¯ÙŠ (Ù…Ø«Ù„Ø§Ù‹: Ø£ÙŠØ¯ÙŠ Ù„ÙŠÙÙ„Ø²)</label><input type="text" id="adm_luid"></div>
                <div class="input-group"><label>Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ± (ÙŠØ¸Ù‡Ø± Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±)</label><input type="text" id="adm_warn"></div>
                <div class="input-group"><label>ID Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</label><input type="text" id="adm_aid"></div>
                <div class="input-group"><label>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù€ ID</label><input type="text" id="adm_aname"></div>
            </div>

            <div class="admin-section">
                <label>ğŸ’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ (Ù†Ù‚Ø§Ø· Ø£Ù… Ø¯ÙˆÙ„Ø§Ø± Ù…Ø¨Ø§Ø´Ø±ØŸ)</label>
                <select id="adm_mode" onchange="toggleAdmPointsRow()">
                    <option value="usd">Ø¯ÙˆÙ„Ø§Ø± Ù…Ø¨Ø§Ø´Ø±</option>
                    <option value="points">Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· (ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø¯ÙˆÙ„Ø§Ø±)</option>
                </select>
                <div id="pointsRow" style="display:none; margin-top:15px; background:rgba(255,255,255,0.05); padding:10px; border-radius:10px;">
                    <div class="input-group"><label>ØªØ³Ù…ÙŠØ© Ø®Ø§Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…Ø«Ù„Ø§Ù‹: Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª)</label><input type="text" id="adm_lpoints"></div>
                    <div class="input-group"><label>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ (ÙƒÙ„ ÙƒÙ… Ù†Ù‚Ø·Ø© = 1 Ø¯ÙˆÙ„Ø§Ø±ØŸ)</label><input type="number" id="adm_prate"></div>
                </div>
            </div>

            <div class="admin-section">
                <label>ğŸ’° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¹ÙŠØ± ÙˆØ§Ù„ÙˆÙƒÙ„Ø§Ø¡</label>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="input-group"><label>Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ø¹Ø§Ù…</label><input type="number" step="0.1" id="adm_rv"></div>
                    <div class="input-group"><label>Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…</label><input type="number" step="0.1" id="adm_ra"></div>
                </div>
                
                <label style="margin-top:15px; display:block;">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ø®ØµØµÙŠÙ† (VIP)</label>
                <div id="adm_agents_container"></div>
                <button onclick="addNewAgentField()" class="btn-action" style="background:#444; color:#fff; width:100%; margin-top:10px;">+ Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ Ø¨Ø³Ø¹Ø± Ø®Ø§Øµ</button>
            </div>

            <button onclick="saveMasterData()" class="btn-submit">Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ…</button>
            <button onclick="deleteCurrentApp()" style="width:100%; background:red; color:white; border:none; margin-top:15px; padding:12px; border-radius:15px; cursor:pointer;">Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ğŸ—‘ï¸</button>
        </div>

        <button onclick="document.getElementById('adminOverlay').style.display='none'" class="btn-action" style="background:#333; color:#fff; width:100%; margin-top:20px; padding:15px;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    </div>
</div>

<script>
    // Firebase Setup
    const firebaseConfig = {
        apiKey: "AIzaSyDp1PmSbyiyP-cEZyPy9sK3FnKKKhbnJKQ",
        authDomain: "karak-13101.firebaseapp.com",
        projectId: "karak-13101",
        databaseURL: "https://karak-13101-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let systems = {};
    let activeSystem = "";

    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ²
    db.ref('Helmy_Card_Pro_v7').on('value', (snap) => {
        systems = snap.val() || { "ÙƒØ±Ùƒ": { rv:45, ra:46, aid:"800050", aname:"Helmy Fire", mode:"usd", luid:"ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ" } };
        renderTabs();
        if(!activeSystem) selectSystem("ÙƒØ±Ùƒ");
        else selectSystem(activeSystem);
    });

    function renderTabs() {
        const nav = document.getElementById('appsNav');
        nav.innerHTML = '';
        for (let name in systems) {
            const btn = document.createElement('button');
            btn.className = `tab-btn ${activeSystem === name ? 'active' : ''}`;
            btn.innerText = name;
            btn.onclick = () => selectSystem(name);
            nav.appendChild(btn);
        }
    }

    function selectSystem(name) {
        activeSystem = name;
        const data = systems[name];
        document.getElementById('userInterface').style.display = 'block';
        document.getElementById('disp_name').innerText = name;
        document.getElementById('disp_warn').innerText = data.warn || "";
        document.getElementById('disp_aid').innerText = data.aid || "";
        document.getElementById('disp_aname').innerText = data.aname || "";
        document.getElementById('lbl_uid').innerText = data.luid || "Ø§Ù„Ø£ÙŠØ¯ÙŠ";

        if(data.mode === 'points') {
            document.getElementById('pointsSection').style.display = 'block';
            document.getElementById('lbl_points').innerText = data.lpoints || "Ø§Ù„Ù†Ù‚Ø§Ø·";
            document.getElementById('usd_input').readOnly = true;
            document.getElementById('usd_input').style.background = "#0a0a0a";
        } else {
            document.getElementById('pointsSection').style.display = 'none';
            document.getElementById('usd_input').readOnly = false;
            document.getElementById('usd_input').style.background = "#151515";
        }

        const vList = document.getElementById('vip_list');
        vList.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ¯ --</option>';
        if(data.agents) {
            for(let code in data.agents) {
                let opt = document.createElement('option');
                opt.value = code; opt.text = code;
                vList.add(opt);
            }
        }
        renderTabs();
        calculatePrice();
    }

    function calculatePrice() {
        if(!activeSystem) return;
        const data = systems[activeSystem];
        
        if(data.mode === 'points') {
            const pts = parseFloat(document.getElementById('points_input').value) || 0;
            const factor = parseFloat(data.prate) || 1;
            document.getElementById('usd_input').value = (pts / factor).toFixed(2);
        }

        const usd = parseFloat(document.getElementById('usd_input').value) || 0;
        const method = document.getElementById('method_select').value;
        let rate = data.rv;

        if(method === 'agent_general') rate = data.ra;
        else if(method === 'agent_private') {
            const code = document.getElementById('vip_list').value;
            rate = (data.agents && data.agents[code]) ? data.agents[code] : data.ra;
        }

        document.getElementById('rate_display').innerText = "Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±: " + rate;
        document.getElementById('egp_display').innerText = (usd * rate).toFixed(2) + " Ø¬.Ù…";
        return { total: (usd * rate).toFixed(2), currentRate: rate };
    }

    function toggleAgentList() {
        document.getElementById('vipAgentGroup').style.display = (document.getElementById('method_select').value === 'agent_private') ? 'block' : 'none';
    }

    function toggleAdmPointsRow() {
        document.getElementById('pointsRow').style.display = (document.getElementById('adm_mode').value === 'points') ? 'block' : 'none';
    }

    function openAdmin() {
        if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") !== "1997") return;
        document.getElementById('adminOverlay').style.display = 'block';
        if(activeSystem) {
            const d = systems[activeSystem];
            document.getElementById('target_app').innerText = activeSystem;
            document.getElementById('adm_token').value = d.token || "";
            document.getElementById('adm_chatid').value = d.chatid || "";
            document.getElementById('adm_sheet').value = d.sheet || "";
            document.getElementById('adm_luid').value = d.luid || "";
            document.getElementById('adm_warn').value = d.warn || "";
            document.getElementById('adm_aid').value = d.aid || "";
            document.getElementById('adm_aname').value = d.aname || "";
            document.getElementById('adm_mode').value = d.mode || "usd";
            document.getElementById('adm_lpoints').value = d.lpoints || "";
            document.getElementById('adm_prate').value = d.prate || "";
            document.getElementById('adm_rv').value = d.rv || 45;
            document.getElementById('adm_ra').value = d.ra || 46;
            toggleAdmPointsRow();
            const container = document.getElementById('adm_agents_container');
            container.innerHTML = '';
            if(d.agents) { for(let c in d.agents) addNewAgentField(c, d.agents[c]); }
            document.getElementById('editZone').style.display = 'block';
        }
    }

    function addNewAgentField(c="", p="") {
        const div = document.createElement('div');
        div.className = 'agent-row';
        div.innerHTML = `<input type="text" class="v-c" value="${c}" placeholder="Ø§Ù„ÙƒÙˆØ¯"><input type="number" step="0.1" class="v-p" value="${p}" placeholder="Ø§Ù„Ø³Ø¹Ø±"><button class="btn-action" style="background:red; color:white;" onclick="this.parentElement.remove()">X</button>`;
        document.getElementById('adm_agents_container').appendChild(div);
    }

    function createNewSystem() {
        const name = document.getElementById('new_app_name').value.trim();
        if(!name) return;
        db.ref('Helmy_Card_Pro_v7/' + name).set({ rv: 45, ra: 46, aid: "000", aname: "Admin", mode: "usd", luid: "Ø§Ù„Ø£ÙŠØ¯ÙŠ" });
    }

    function saveMasterData() {
        const newAgents = {};
        document.querySelectorAll('.agent-row').forEach(row => {
            const c = row.querySelector('.v-c').value;
            const p = row.querySelector('.v-p').value;
            if(c && p) newAgents[c] = parseFloat(p);
        });

        const updated = {
            token: document.getElementById('adm_token').value,
            chatid: document.getElementById('adm_chatid').value,
            sheet: document.getElementById('adm_sheet').value,
            luid: document.getElementById('adm_luid').value,
            warn: document.getElementById('adm_warn').value,
            aid: document.getElementById('adm_aid').value,
            aname: document.getElementById('adm_aname').value,
            mode: document.getElementById('adm_mode').value,
            lpoints: document.getElementById('adm_lpoints').value,
            prate: document.getElementById('adm_prate').value,
            rv: parseFloat(document.getElementById('adm_rv').value),
            ra: parseFloat(document.getElementById('adm_ra').value),
            agents: newAgents
        };
        db.ref('Helmy_Card_Pro_v7/' + activeSystem).update(updated).then(() => alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…"));
    }

    function deleteCurrentApp() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            db.ref('Helmy_Card_Pro_v7/' + activeSystem).remove();
            activeSystem = "";
            document.getElementById('adminOverlay').style.display = 'none';
        }
    }

    function copyMasterID() {
        navigator.clipboard.writeText(systems[activeSystem].aid);
        alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø£ÙŠØ¯ÙŠ!");
    }

    async function submitFinalOrder() {
        const file = document.getElementById('file_input').files[0];
        const uid = document.getElementById('user_id_input').value;
        const config = systems[activeSystem];

        if(!file || !uid || !config.token) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");

        const { total, currentRate } = calculatePrice();
        const date = new Date().toLocaleString('ar-EG');
        let ptsTxt = config.mode === 'points' ? `ğŸ”¢ Ø§Ù„Ù†Ù‚Ø§Ø·: ${document.getElementById('points_input').value}\n` : '';
        
        const caption = `ğŸ“¦ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù†: ${activeSystem}\nâ”â”â”â”â”â”â”â”â”â”â”â”\nğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${uid}\n${ptsTxt}ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${document.getElementById('usd_input').value}$\nğŸ’¹ Ø§Ù„Ø³Ø¹Ø±: ${currentRate}\nğŸ‡ªğŸ‡¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…\nğŸ’³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: ${document.getElementById('method_select').value}\nğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${document.getElementById('wallet_input').value}\nâ”â”â”â”â”â”â”â”â”â”â”â”\nâ° Ø§Ù„ÙˆÙ‚Øª: ${date}`;

        const fd = new FormData();
        fd.append('chat_id', config.chatid);
        fd.append('photo', file);
        fd.append('caption', caption);

        try {
            await fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, { method: 'POST', body: fd });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° Ù‚Ø±ÙŠØ¨Ø§Ù‹ âœ…");
            location.reload();
        } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…"); }
    }
</script>

</body>
</html>
