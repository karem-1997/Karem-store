<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELMY CARD | Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --main: #8a2be2; --bg: #000; --card: #0d0d0d; --green: #00ff00; --red: #ff3333; --gray: #1a1a1a; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: #fff; margin: 0; padding-bottom: 60px; overflow-x: hidden; }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
        header { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: #000; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: bold; font-size: 1.3rem; color: var(--main); cursor: pointer; }
        .user-tools { display: flex; align-items: center; gap: 10px; }
        .bal-box { background: rgba(138, 43, 226, 0.1); padding: 5px 12px; border-radius: 20px; color: var(--main); border: 1px solid var(--main); font-weight: bold; font-size: 0.9rem; }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ¬Ø± --- */
        .container { padding: 15px; }
        .cat-bar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; }
        .cat-chip { background: var(--gray); padding: 8px 18px; border-radius: 15px; white-space: nowrap; cursor: pointer; font-size: 0.85rem; border: 1px solid transparent; }
        .cat-chip.active { background: var(--main); border-color: var(--main); }

        .prod-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .p-card { background: var(--card); border-radius: 20px; padding: 10px; text-align: center; border: 1px solid #1a1a1a; position: relative; }
        .p-card img { width: 100%; aspect-ratio: 1/1; border-radius: 15px; object-fit: cover; }
        .p-card h4 { margin: 8px 0 4px; font-size: 0.9rem; color: #fff; }
        .p-card b { color: var(--main); font-size: 1rem; }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ (Full Screen) --- */
        .full-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
        .full-page.active { display: flex; }
        .m-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .buy-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .in-box { background: #111; padding: 15px; border-radius: 25px; text-align: center; border: 1px solid #222; }
        .in-box label { display: block; color: #666; font-size: 0.75rem; margin-bottom: 5px; }
        .in-box input { background: transparent; border: none; color: #fff; text-align: center; width: 100%; font-size: 1.3rem; outline: none; font-weight: bold; }

        .id-box { background: #111; padding: 18px; border-radius: 25px; border: 1px solid #222; margin-bottom: 25px; }
        .id-box input { background: transparent; border: none; color: #fff; width: 100%; text-align: center; font-size: 1.4rem; outline: none; }

        .btn-main { background: linear-gradient(45deg, #4b0082, #8a2be2); border: none; padding: 16px; border-radius: 30px; color: #fff; font-weight: bold; font-size: 1.1rem; cursor: pointer; width: 100%; }
        .btn-sec { background: transparent; border: 1px solid #333; padding: 16px; border-radius: 30px; color: #fff; cursor: pointer; width: 100%; margin-top: 10px; }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… --- */
        .admin-nav { display: flex; gap: 10px; overflow-x: auto; background: #0a0a0a; padding: 10px; border-bottom: 1px solid var(--main); }
        .tab-btn { background: #1a1a1a; color: #fff; border: none; padding: 8px 15px; border-radius: 10px; white-space: nowrap; font-size: 0.8rem; }
        .tab-btn.active { background: var(--main); }

        .admin-card { background: #111; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-right: 4px solid var(--main); }
        .hidden { display: none !important; }

        /* --- Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ --- */
        .charge-modal { background: #0a0a0a; padding: 20px; border-radius: 25px; border: 1px solid var(--main); width: 90%; max-width: 400px; }

        input, select { background: #111; border: 1px solid #222; color: #fff; padding: 12px; border-radius: 12px; width: 100%; margin: 8px 0; outline: none; }
        .notice { font-size: 0.75rem; color: #555; text-align: center; line-height: 1.5; margin-top: 20px; }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="location.reload()">HELMY CARD</div>
    <div class="user-tools">
        <div class="bal-box" id="userBal">0 Ø¬</div>
        <i class="fa-solid fa-circle-user" style="font-size: 1.5rem; color: var(--main); cursor: pointer;" onclick="toggleLogin()"></i>
    </div>
</header>

<div id="storeView" class="container">
    <div class="cat-bar" id="catBar">
        <div class="cat-chip active" onclick="filterCat('all')">Ø§Ù„ÙƒÙ„</div>
    </div>
    <div class="prod-grid" id="prodGrid">
        </div>
</div>

<div id="adminView" class="hidden">
    <div class="admin-nav">
        <button class="tab-btn active" onclick="showTab('ordersTab', this)">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù† ğŸ””</button>
        <button class="tab-btn" onclick="showTab('salesTab', this)">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
        <button class="tab-btn" onclick="showTab('manageTab', this)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…/Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
        <button class="tab-btn" onclick="showTab('usersTab', this)">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆØ§Ù„Ø£Ø¯Ù…Ù†</button>
    </div>

    <div id="ordersTab" class="tab-content container">
        <h3>Ø·Ù„Ø¨Ø§Øª Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h3>
        <div id="chargeRequests"></div>
    </div>

    <div id="salesTab" class="tab-content container hidden">
        <h3>Ø·Ù„Ø¨Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
        <div id="productRequests"></div>
    </div>

    <div id="manageTab" class="tab-content container hidden">
        <div class="admin-card">
            <h4>+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</h4>
            <input type="text" id="newCatName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
            <button class="btn-main" style="padding:10px" onclick="addCategory()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù…</button>
        </div>
        <div class="admin-card">
            <h4>+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h4>
            <select id="catSelect"></select>
            <input type="text" id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="pp" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù„ÙƒÙ„ ÙˆØ­Ø¯Ø©">
            <input type="number" id="pq" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© (ÙƒÙˆÙŠÙ†Ø²)">
            <input type="file" id="pi">
            <button class="btn-main" style="padding:10px" onclick="addProduct()">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>
        <div id="editList"></div>
    </div>

    <div id="usersTab" class="tab-content container hidden">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
        <div id="usersList"></div>
    </div>
</div>

<div id="buyModal" class="full-page">
    <div class="m-header">
        <span class="bal-box" id="mPrice">0 Ø¬</span>
        <span style="font-weight: bold; color: var(--main);" id="mName">--</span>
    </div>
    <div class="buy-grid">
        <div class="in-box">
            <label>Ø§Ù„Ø¹Ø¯Ø¯</label>
            <input type="number" id="buyQty" oninput="calcBuy()">
        </div>
        <div class="in-box">
            <label>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
            <div style="font-size:1.3rem; font-weight:bold;"><span id="buyTotal">0</span> <small>Ø¬</small></div>
        </div>
    </div>
    <div class="id-box">
        <input type="text" id="playerID" placeholder="ID Ø§Ù„Ø­Ø³Ø§Ø¨">
    </div>
    <button class="btn-main" onclick="confirmPurchase()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
    <button class="btn-sec" onclick="closeFull()">Ø¥Ù„ØºØ§Ø¡</button>
    <div class="notice">Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙˆØ±Ø§Ù‹. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠØ©.</div>
</div>

<div id="chargeModal" class="full-page">
    <div class="charge-modal" style="margin: auto;">
        <h2 style="text-align:center; color:var(--main)">Ø´Ø­Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©</h2>
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø´Ø­Ù†Ù‡:</label>
        <input type="number" id="cAmount" placeholder="0.00">
        <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡Ø§:</label>
        <input type="text" id="cPhone" placeholder="010xxxxxxx">
        <label>Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª Ø§Ù„ØªØ­ÙˆÙŠÙ„:</label>
        <input type="file" id="cImg" accept="image/*">
        <button class="btn-main" onclick="submitChargeRequest()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø¯ÙŠØ±</button>
        <button class="btn-sec" onclick="closeFull()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="loginModal" class="full-page" style="justify-content:center; align-items:center;">
    <div style="width:100%; max-width:400px; padding:20px;">
        <h2 style="text-align:center; color:var(--main)">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¬Ø¯ÙŠØ¯</h2>
        <input type="email" id="le" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="lp" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <input type="text" id="ln" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (Ù„Ù„Ø¬Ø¯Ø¯)">
        <button class="btn-main" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ©</button>
        <button class="btn-sec" onclick="closeFull()">Ø¥ØºØ§Ø¡</button>
        <p style="text-align:center; font-size:0.8rem; margin-top:15px; color:#444;">ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¬ÙŠØ¯Ø§Ù‹</p>
    </div>
</div>

<div id="navBar" class="hidden" style="position:fixed; bottom:0; width:100%; background:#0a0a0a; display:flex; justify-content:space-around; padding:10px; border-top:1px solid #222;">
    <i class="fa-solid fa-shop" style="color:var(--main)" onclick="location.reload()"></i>
    <i class="fa-solid fa-wallet" onclick="openCharge()"></i>
    <i class="fa-solid fa-clock-rotate-left"></i>
    <i class="fa-solid fa-right-from-bracket" onclick="location.reload()"></i>
</div>

<script>
    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyAalmOWMUhvCi_PuFSUbXRpbe1hmGyer7s",
        authDomain: "karem-store.firebaseapp.com",
        databaseURL: "https://karem-store-default-rtdb.firebaseio.com",
        projectId: "karem-store",
        storageBucket: "karem-store.firebasestorage.app",
        messagingSenderId: "898294902448",
        appId: "1:898294902448:web:23cbee5afd72adcb67d575"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let user = null; let selP = null;

    function closeFull() { document.querySelectorAll('.full-page').forEach(m=>m.classList.remove('active')); }
    function toggleLogin() { document.getElementById('loginModal').classList.add('active'); }
    function openCharge() { if(!user) return toggleLogin(); document.getElementById('chargeModal').classList.add('active'); }
    
    function showTab(id, btn) {
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        btn.classList.add('active');
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø£Ù…Ø§Ù† ---
    function handleAuth() {
        const e = document.getElementById('le').value.replace(/\./g, '_').toLowerCase();
        const p = document.getElementById('lp').value;
        const n = document.getElementById('ln').value;

        if(e === 'admin@karem_com' && p === '123456') {
            setup({ name: 'ÙƒØ±ÙŠÙ… (Ø§Ù„Ù…Ø¯ÙŠØ±)', email: e, role: 'admin', balance: 999999, uid: 'MASTER' });
            return;
        }

        db.ref('users/'+e).once('value', s => {
            if(s.exists() && s.val().pass === p) {
                setup(s.val());
            } else if (!s.exists()) {
                const id = Math.floor(Math.random()*9000)+1000;
                const u = { name: n, email: e, pass: p, balance: 0, role: 'user', uid: id };
                db.ref('users/'+e).set(u);
                db.ref('idMap/'+id).set(e);
                setup(u);
            } else alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        });
    }

    function setup(d) {
        user = d;
        closeFull();
        document.getElementById('uName').innerText = d.name;
        db.ref('users/'+d.email+'/balance').on('value', s => {
            user.balance = s.val() || 0;
            document.getElementById('userBal').innerText = user.balance + " Ø¬";
        });
        document.getElementById('navBar').classList.remove('hidden');
        if(d.role === 'admin') {
            document.getElementById('adminView').classList.remove('hidden');
            document.getElementById('storeView').classList.add('hidden');
            listenRequests();
            loadAdminTools();
        }
    }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… ---
    function addCategory() {
        const name = document.getElementById('newCatName').value;
        db.ref('categories').push({ name: name });
        alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù…");
    }

    function addProduct() {
        const cat = document.getElementById('catSelect').value;
        const n = document.getElementById('pn').value;
        const p = Number(document.getElementById('pp').value);
        const q = Number(document.getElementById('pq').value);
        const f = document.getElementById('pi').files[0];
        const r = new FileReader();
        r.onload = e => db.ref('products/'+cat).push({ n, p, q, img: e.target.result });
        r.readAsDataURL(f); alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±");
    }

    function loadAdminTools() {
        db.ref('categories').on('value', s => {
            const sel = document.getElementById('catSelect'); sel.innerHTML = "";
            const editList = document.getElementById('editList'); editList.innerHTML = "<h4>Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h4>";
            s.forEach(c => {
                sel.innerHTML += `<option value="${c.key}">${c.val().name}</option>`;
                editList.innerHTML += `<div class="admin-card" style="display:flex; justify-content:space-between;">
                    <span>${c.val().name}</span>
                    <button onclick="deleteCat('${c.key}')" style="background:red; color:#fff; border:none; border-radius:5px;">Ø­Ø°Ù</button>
                </div>`;
            });
        });
    }
    function deleteCat(id) { if(confirm("Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù… Ø¨ÙƒÙ„ Ù…Ù†ØªØ¬Ø§ØªÙ‡ØŸ")) { db.ref('categories/'+id).remove(); db.ref('products/'+id).remove(); } }

    // --- Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± Ù„Ù„ÙˆÙƒÙŠÙ„ ÙˆØ§Ù„Ø²Ø§Ø¦Ø± ---
    function loadStore() {
        db.ref('categories').on('value', s => {
            const bar = document.getElementById('catBar'); bar.innerHTML = `<div class="cat-chip active" onclick="filterCat('all')">Ø§Ù„ÙƒÙ„</div>`;
            s.forEach(c => {
                bar.innerHTML += `<div class="cat-chip" onclick="filterCat('${c.key}')">${c.val().name}</div>`;
            });
        });
        filterCat('all');
    }

    function filterCat(id) {
        const grid = document.getElementById('prodGrid'); grid.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
        const path = id === 'all' ? db.ref('products') : db.ref('products/'+id);
        path.on('value', s => {
            grid.innerHTML = "";
            const process = (data) => {
                grid.innerHTML += `<div class="p-card" onclick='openBuy(${JSON.stringify(data)})'>
                    <img src="${data.img}"><h4>${data.n}</h4><b>${data.p} Ø¬</b>
                </div>`;
            };
            if(id === 'all') { s.forEach(child => child.forEach(p => process(p.val()))); }
            else { s.forEach(p => process(p.val())); }
        });
    }

    // --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ (Calculations) ---
    function openBuy(p) {
        if(!user) return toggleLogin();
        selP = p;
        document.getElementById('buyModal').classList.add('active');
        document.getElementById('mName').innerText = p.n;
        document.getElementById('mPrice').innerText = p.p + " Ø¬";
        document.getElementById('buyQty').value = p.q;
        calcBuy();
    }

    function calcBuy() {
        const q = Number(document.getElementById('buyQty').value);
        const total = (q / selP.q) * selP.p;
        document.getElementById('buyTotal').innerText = total.toFixed(2);
    }

    function confirmPurchase() {
        const id = document.getElementById('playerID').value;
        const tot = Number(document.getElementById('buyTotal').innerText);
        if(!id) return alert("Ø§Ø¯Ø®Ù„ ID Ø§Ù„Ù„Ø§Ø¹Ø¨");
        if(user.balance < tot) return alert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠØŒ ÙŠØ±Ø¬Ù‰ Ø´Ø­Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©");

        db.ref('users/'+user.email).update({ balance: (user.balance - tot).toFixed(2) });
        db.ref('requests/sales').push({
            uName: user.name, uMail: user.email, prod: selP.n, qty: document.getElementById('buyQty').value,
            total: tot, gameID: id, status: 'pending', time: new Date().toLocaleString()
        });
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø¯ÙŠØ± Ù„Ù„ØªÙ†ÙÙŠØ°");
        closeFull();
    }

    // --- Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ (Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª) ---
    function submitChargeRequest() {
        const amt = document.getElementById('cAmount').value;
        const phone = document.getElementById('cPhone').value;
        const file = document.getElementById('cImg').files[0];
        if(!amt || !file) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø©");
        
        const r = new FileReader();
        r.onload = e => {
            db.ref('requests/charge').push({
                uName: user.name, uMail: user.email, amount: amt, phone: phone, 
                img: e.target.result, status: 'pending', time: new Date().toLocaleString()
            });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†ØŒ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙˆØ±Ø©");
            closeFull();
        };
        r.readAsDataURL(file);
    }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯ÙŠØ± (Ø§Ù„Ø§Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©) ---
    function listenRequests() {
        // Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù†
        db.ref('requests/charge').on('value', s => {
            const list = document.getElementById('chargeRequests'); list.innerHTML = "";
            s.forEach(r => {
                const d = r.val();
                if(d.status === 'pending') {
                    list.innerHTML += `<div class="admin-card">
                        <b>${d.uName} ÙŠØ·Ù„Ø¨ ${d.amount} Ø¬</b><br>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙˆÙ„: ${d.phone}<br>
                        <img src="${d.img}" style="width:100px; cursor:pointer;" onclick="window.open('${d.img}')"><br>
                        <button class="btn-main" style="width:45%; background:green" onclick="approveCharge('${r.key}','${d.uMail}',${d.amount})">Ù‚Ø¨ÙˆÙ„ âœ…</button>
                        <button class="btn-main" style="width:45%; background:red" onclick="rejectReq('charge','${r.key}')">Ø±ÙØ¶ âŒ</button>
                    </div>`;
                }
            });
        });
        // Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        db.ref('requests/sales').on('value', s => {
            const list = document.getElementById('productRequests'); list.innerHTML = "";
            s.forEach(r => {
                const d = r.val();
                if(d.status === 'pending') {
                    list.innerHTML += `<div class="admin-card">
                        <b>${d.prod} (${d.qty})</b><br>Ø§Ù„Ù„Ø§Ø¹Ø¨ ID: <span style="color:var(--green)">${d.gameID}</span><br>
                        Ø§Ù„ÙˆÙƒÙŠÙ„: ${d.uName}<br>
                        <button class="btn-main" style="width:45%; background:green" onclick="approveSale('${r.key}')">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° âœ…</button>
                        <button class="btn-main" style="width:45%; background:red" onclick="rejectSale('${r.key}','${d.uMail}',${d.total})">Ø±ÙØ¶ ÙˆØ§Ø±Ø¬Ø§Ø¹ Ù…Ø§Ù„ âŒ</button>
                    </div>`;
                }
            });
        });
    }

    function approveCharge(key, mail, amt) {
        db.ref('users/'+mail).once('value', s => {
            const current = Number(s.val().balance || 0);
            db.ref('users/'+mail).update({ balance: (current + Number(amt)).toFixed(2) });
            db.ref('requests/charge/'+key).update({ status: 'approved' });
        });
    }
    function approveSale(key) { db.ref('requests/sales/'+key).update({ status: 'done' }); }
    function rejectSale(key, mail, amt) {
        db.ref('users/'+mail).once('value', s => {
            const current = Number(s.val().balance || 0);
            db.ref('users/'+mail).update({ balance: (current + Number(amt)).toFixed(2) });
            db.ref('requests/sales/'+key).update({ status: 'rejected' });
        });
    }
    function rejectReq(path, key) { db.ref('requests/'+path+'/'+key).update({ status: 'rejected' }); }

    loadStore();
</script>
</body>
</html>
