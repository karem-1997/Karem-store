<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ø§Ù„Ù…Ø§Ø³ØªØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root { --gold: linear-gradient(180deg, #fcf6ba 0%, #bf953f 100%); --bg: #0a0a0a; --in: #151515; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .main-header { font-size: 32px; font-weight: 900; color: #fcf6ba; margin: 20px 0; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .warn { color: #ff3b3b; font-weight: bold; font-size: 14px; text-align: center; margin-bottom: 15px; }
        .id-box { width: 100%; max-width: 400px; border: 1px dashed #bf953f; border-radius: 20px; padding: 15px; text-align: center; margin-bottom: 20px; cursor: pointer; }
        .form-area { width: 100%; max-width: 420px; display: none; }
        .group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #fcf6ba; font-size: 15px; }
        input, select { width: 100%; background: var(--in); border: 1px solid #2a2a2a; border-radius: 12px; padding: 15px; color: #fff; box-sizing: border-box; outline: none; text-align: right; }
        .total-card { background: #111; border-radius: 20px; padding: 20px; text-align: center; border: 1px solid #1a1a1a; margin: 15px 0; }
        .btn-gold { width: 100%; padding: 18px; background: var(--gold); border: none; border-radius: 15px; font-size: 18px; font-weight: 900; color: #000; cursor: pointer; }
        /* Admin */
        #admin { display: none; position: fixed; inset: 0; background: #000; z-index: 1000; padding: 15px; overflow-y: auto; }
        .admin-in { border: 1px solid #bf953f; border-radius: 25px; padding: 20px; max-width: 500px; margin: auto; }
        .v-grid { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="main-header" onclick="checkAdmin()">ğŸ”— Helmy Card</div>
<div class="warn" id="v_warn"></div>
<div id="tabs" style="display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap;"></div>

<div class="form-area" id="ui">
    <div class="id-box" onclick="copyID()">
        <div style="color:#aaa;">ID Ø³Ø­Ø¨: <b id="v_aid" style="color:white;"></b></div>
        <div style="color:#aaa;">Ø§Ù„Ù…Ø³ØªÙ„Ù…: <b id="v_aname" style="color:white;"></b></div>
        <div style="color:gold; font-size:11px; margin-top:5px;">Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø® ğŸ‘†</div>
    </div>

    <div class="group">
        <label id="l_uid">Ø§Ù„Ø£ÙŠØ¯ÙŠ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨ Ù…Ù†Ù‡ ğŸ†”</label>
        <input type="text" id="i_uid" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠØ¯ÙŠ">
    </div>

    <div class="group" id="pts_row" style="display:none;">
        <label id="l_pts">Ø§Ù„Ù†Ù‚Ø§Ø·</label>
        <input type="number" id="i_pts" placeholder="0" oninput="calc()">
    </div>

    <div class="group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
        <select id="i_meth" onchange="toggleVip(); calc();">
            <option value="cash">ÙÙˆØ¯Ø§ÙÙˆÙ† / Ø§ØªØµØ§Ù„Ø§Øª / Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´</option>
            <option value="agent_all">Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…ÙˆØ­Ø¯</option>
            <option value="agent_vip">ÙƒÙˆØ¯ ÙˆÙƒÙŠÙ„ Ù…Ø®ØµØµ ğŸ”½</option>
        </select>
    </div>

    <div class="group" id="vip_row" style="display:none;">
        <label>Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <select id="i_vip_sel" onchange="calc()"></select>
    </div>

    <div class="group">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)</label>
        <input type="number" id="i_usd" placeholder="0.00" oninput="calc()">
    </div>

    <div class="total-card">
        <div id="r_info" style="color:gold; font-size:12px;">Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø´: 0</div>
        <div style="font-size:26px; font-weight:900;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="r_egp">0.00</span> Ø¬.Ù…</div>
    </div>

    <div class="group"><label>Ø±Ù‚Ù… Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label><input type="text" id="i_wallet" placeholder="01xxxxxxxxx"></div>
    <div class="group"><label>ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</label><input type="file" id="i_file" accept="image/*"></div>

    <button class="btn-gold" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="admin">
    <div class="admin-in">
        <h2 style="color:gold; text-align:center;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
        <div class="group"><label>Ø±Ø§Ø¨Ø· Google Script</label><input type="text" id="a_sheet"></div>
        <div class="group"><label>ØªÙˆÙƒÙ† Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</label><input type="text" id="a_token"></div>
        <div class="group"><label>Chat ID</label><input type="text" id="a_chat"></div>
        <div class="group"><label>Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ±</label><input type="text" id="a_warn"></div>
        <div style="display:flex; gap:10px;">
            <div class="group"><label>ID Ø§Ù„Ø³Ø­Ø¨</label><input type="text" id="a_aid"></div>
            <div class="group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label><input type="text" id="a_aname"></div>
        </div>
        <div class="group"><label>Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙŠØ¯ÙŠ</label><input type="text" id="a_luid"></div>
        <div style="display:flex; gap:10px;">
            <div class="group"><label>Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø´</label><input type="number" id="a_rv"></div>
            <div class="group"><label>Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</label><input type="number" id="a_ra"></div>
        </div>
        <div class="group"><label>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„</label><select id="a_mode" onchange="tAdmPts()"><option value="usd">Ø¯ÙˆÙ„Ø§Ø±</option><option value="pts">Ù†Ù‚Ø§Ø·</option></select></div>
        <div id="a_pts_c" style="display:none; background:#111; padding:10px; border-radius:10px; margin-bottom:10px;">
            <input type="text" id="a_lpts" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø·" style="margin-bottom:5px;">
            <input type="number" id="a_prate" placeholder="ÙƒÙ… Ù†Ù‚Ø·Ø© = 1 Ø¯ÙˆÙ„Ø§Ø±ØŸ">
        </div>
        <label style="color:gold;">Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ (ÙƒÙˆØ¯ | Ø§Ø³Ù… | Ø³Ø¹Ø±):</label>
        <div id="a_v_list"></div>
        <button class="btn-gold" style="background:green; height:40px; font-size:14px; margin-bottom:10px;" onclick="addARow()">+ Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„</button>
        <button class="btn-gold" onclick="save()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…</button>
        <button class="btn-gold" style="background:#333; color:#fff; margin-top:10px;" onclick="document.getElementById('admin').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://karak-13101-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let apps = {}; let active = "";

    db.ref('Helmy_Final_System_V8').on('value', (s) => {
        apps = s.val() || { "ÙƒØ±Ùƒ": { rv:45, ra:46.5, aid:"800055", aname:"Helmy fire", mode:"usd", luid:"ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ" } };
        drawTabs(); if(!active) select("ÙƒØ±Ùƒ"); else select(active);
    });

    function drawTabs() {
        const area = document.getElementById('tabs'); area.innerHTML = '';
        for(let n in apps) {
            const b = document.createElement('button');
            b.style = `padding:10px; border-radius:10px; border:1px solid #333; cursor:pointer; background:${active===n?'#bf953f':'#1a1a1a'}; color:${active===n?'#000':'#888'}`;
            b.innerText = n; b.onclick = () => select(n); area.appendChild(b);
        }
    }

    function select(n) {
        active = n; const d = apps[n];
        document.getElementById('ui').style.display = 'block';
        document.getElementById('v_warn').innerText = d.warn || "";
        document.getElementById('v_aid').innerText = d.aid || "";
        document.getElementById('v_aname').innerText = d.aname || "";
        document.getElementById('l_uid').innerText = d.luid || "Ø§Ù„Ø£ÙŠØ¯ÙŠ";
        document.getElementById('pts_row').style.display = d.mode==='pts'?'block':'none';
        if(d.mode==='pts') { document.getElementById('l_pts').innerText = d.lpts; document.getElementById('i_usd').readOnly = true; }
        const sel = document.getElementById('i_vip_sel'); sel.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒÙŠÙ„ --</option>';
        if(d.agents) for(let id in d.agents) { let o = document.createElement('option'); o.value=id; o.text=`${d.agents[id].name} (${id})`; sel.add(o); }
        drawTabs(); calc();
    }

    function calc() {
        const d = apps[active]; if(!d) return;
        if(d.mode==='pts') { let p = parseFloat(document.getElementById('i_pts').value)||0; document.getElementById('i_usd').value = (p/(d.prate||1)).toFixed(2); }
        let usd = parseFloat(document.getElementById('i_usd').value)||0;
        let m = document.getElementById('i_meth').value;
        let r = d.rv; if(m==='agent_all') r = d.ra; else if(m==='agent_vip') { let v = document.getElementById('i_vip_sel').value; r = (d.agents && d.agents[v])?d.agents[v].price:d.ra; }
        document.getElementById('r_info').innerText = "Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±: "+r;
        document.getElementById('r_egp').innerText = (usd*r).toFixed(2);
        return { total: (usd*r).toFixed(2), rate: r };
    }

    function toggleVip() { document.getElementById('vip_row').style.display = (document.getElementById('i_meth').value==='agent_vip')?'block':'none'; }
    function tAdmPts() { document.getElementById('a_pts_c').style.display = (document.getElementById('a_mode').value==='pts')?'block':'none'; }
    function checkAdmin() { if(prompt("Pass:")==="1997") { document.getElementById('admin').style.display='block'; loadAdm(); } }

    function loadAdm() {
        const d = apps[active]; document.getElementById('a_sheet').value=d.sheet||""; document.getElementById('a_token').value=d.token||"";
        document.getElementById('a_chat').value=d.chatid||""; document.getElementById('a_warn').value=d.warn||"";
        document.getElementById('a_aid').value=d.aid||""; document.getElementById('a_aname').value=d.aname||"";
        document.getElementById('a_luid').value=d.luid||""; document.getElementById('a_rv').value=d.rv||45;
        document.getElementById('a_ra').value=d.ra||46; document.getElementById('a_mode').value=d.mode||"usd";
        document.getElementById('a_lpts').value=d.lpts||""; document.getElementById('a_prate').value=d.prate||"";
        const list = document.getElementById('a_v_list'); list.innerHTML = ''; tAdmPts();
        if(d.agents) for(let id in d.agents) addARow(id, d.agents[id].name, d.agents[id].price);
    }

    function addARow(id="", n="", p="") {
        const d = document.createElement('div'); d.className='v-grid';
        d.innerHTML = `<input type="text" class="v-i" value="${id}" placeholder="ID"><input type="text" class="v-n" value="${n}" placeholder="Name"><input type="number" class="v-p" value="${p}" placeholder="Price"><button onclick="this.parentElement.remove()">X</button>`;
        document.getElementById('a_v_list').appendChild(d);
    }

    function save() {
        let ags = {}; document.querySelectorAll('.v-grid').forEach(r => { let id=r.querySelector('.v-i').value; if(id) ags[id]={name:r.querySelector('.v-n').value, price:parseFloat(r.querySelector('.v-p').value)}; });
        let up = { sheet:document.getElementById('a_sheet').value, token:document.getElementById('a_token').value, chatid:document.getElementById('a_chat').value, warn:document.getElementById('a_warn').value, aid:document.getElementById('a_aid').value, aname:document.getElementById('a_aname').value, luid:document.getElementById('a_luid').value, rv:parseFloat(document.getElementById('a_rv').value), ra:parseFloat(document.getElementById('a_ra').value), mode:document.getElementById('a_mode').value, lpts:document.getElementById('a_lpts').value, prate:document.getElementById('a_prate').value, agents:ags };
        db.ref('Helmy_Final_System_V8/'+active).update(up).then(()=>alert("Saved!"));
    }

    async function sendOrder() {
        const file = document.getElementById('i_file').files[0]; const uid = document.getElementById('i_uid').value; const config = apps[active];
        if(!file || !uid || !config.token) return alert("Missing Info!");
        const { total, rate } = calc();
        let agentName = "ÙƒØ§Ø´";
        if(document.getElementById('i_meth').value==='agent_vip') agentName = config.agents[document.getElementById('i_vip_sel').value].name;
        else if(document.getElementById('i_meth').value==='agent_all') agentName = "ÙˆÙƒÙŠÙ„ Ø¹Ø§Ù…";

        // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¥ÙƒØ³Ù„
        if(config.sheet) {
            const sData = { uid:uid, agentName:agentName, usdAmount:document.getElementById('i_usd').value, egpAmount:total, method:document.getElementById('i_meth').value, wallet:document.getElementById('i_wallet').value };
            fetch(config.sheet, { method:'POST', mode:'no-cors', body:JSON.stringify(sData) });
        }

        const msg = `ğŸ“¦ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: ${active}\nğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${uid}\nğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${agentName}\nğŸ’µ Ù…Ø¨Ù„Øº: ${document.getElementById('i_usd').value}$\nğŸ’¹ Ø§Ù„Ø³Ø¹Ø±: ${rate}\nğŸ‡ªğŸ‡¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…\nğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${document.getElementById('i_wallet').value}\nâ° ${new Date().toLocaleString('ar-EG')}`;
        const fd = new FormData(); fd.append('chat_id', config.chatid); fd.append('photo', file); fd.append('caption', msg);
        await fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, { method:'POST', body:fd });
        alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ âœ…"); location.reload();
    }
    function copyID() { navigator.clipboard.writeText(document.getElementById('v_aid').innerText); alert("Copied!"); }
</script>
</body>
</html>
