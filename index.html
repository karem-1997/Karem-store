<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAREM STORE | Ø§Ù„Ø¹Ø¸Ù…Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <style>
        :root { --main: #ff0000; --bg: #000000; --card: #111111; --text: #ffffff; --gray: #888; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; overflow-x: hidden; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: #000; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #111; position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 900; font-size: 1.5rem; color: var(--main); }
        .user-info { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        .bal-box { background: rgba(0,255,0,0.1); color: #00ff00; padding: 4px 10px; border-radius: 10px; border: 1px solid #00ff00; }

        /* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± */
        .slider { width: 95%; height: 160px; margin: 10px auto; border-radius: 15px; overflow: hidden; position: relative; border: 1px solid #222; }
        .slides { display: flex; transition: 0.5s; height: 100%; }
        .slides img { min-width: 100%; object-fit: cover; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .section-header { padding: 15px; font-weight: bold; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; color: var(--main); }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 15px; }
        .item-card { background: var(--card); border-radius: 12px; border: 1px solid #222; padding: 8px; text-align: center; }
        .item-card img { width: 100%; border-radius: 8px; margin-bottom: 5px; aspect-ratio: 1/1; object-fit: cover; }
        .item-card h4 { font-size: 0.7rem; margin: 5px 0; height: 30px; overflow: hidden; }
        .item-card b { color: #00ff00; font-size: 0.8rem; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-menu { position: fixed; top: 0; right: -100%; width: 80%; height: 100%; background: #050505; z-index: 3000; transition: 0.3s; padding: 20px; border-left: 1px solid #222; }
        .side-menu.active { right: 0; }
        .menu-btn { width: 100%; padding: 12px; margin-top: 10px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        .admin-panel { background: #0a0000; border: 2px dashed var(--main); margin: 15px; padding: 15px; border-radius: 15px; }
        .admin-tab { margin-top: 10px; padding: 10px; background: #000; border-radius: 8px; border: 1px solid #222; }
        
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .hidden { display: none !important; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; z-index: 2500; }
    </style>
</head>
<body>

<header>
    <div class="logo">KAREM STORE</div>
    <div id="topUser" class="user-info hidden">
        <div class="bal-box"><span id="uBal">0</span> Ø¬</div>
        <div style="color: #888;">ID: <span id="uID">--</span></div>
    </div>
    <i class="fa-solid fa-bars" style="font-size: 1.5rem;" onclick="toggleMenu()"></i>
</header>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="slider">
    <div class="slides" id="sliderContainer">
        <img src="https://img.freepik.com/premium-photo/gaming-banner-design_1143431-13.jpg"> </div>
</div>

<div id="storeFront">
    <div class="section-header"><i class="fa-solid fa-gamepad"></i> Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
    <div class="grid" id="gamesGrid"></div>

    <div class="section-header"><i class="fa-solid fa-clapperboard"></i> Ù‚Ø³Ù… Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</div>
    <div class="grid" id="appsGrid"></div>

    <div class="section-header"><i class="fa-solid fa-hashtag"></i> Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§</div>
    <div class="grid" id="socialGrid"></div>
</div>

<div id="adminArea" class="hidden">
    <div class="admin-panel">
        <h3 style="margin-top:0">ğŸ› ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
        <div class="admin-tab">
            <h4>1. Ø´Ø­Ù† Ø±ØµÙŠØ¯ Ù„ÙˆÙƒÙŠÙ„</h4>
            <input type="number" id="targetID" placeholder="ID Ø§Ù„ÙˆÙƒÙŠÙ„ (Ù…Ø«Ù„Ø§Ù‹ 1001)">
            <button class="menu-btn" style="background:#00f" onclick="searchAgent()">Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙˆÙƒÙŠÙ„</button>
            <div id="agentFound" class="hidden" style="margin-top:10px;">
                <p id="agentName"></p>
                <input type="number" id="addAmt" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <button class="menu-btn" style="background:#00ff00; color:#000" onclick="confirmAddMoney()">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯ âœ…</button>
            </div>
        </div>
        <div class="admin-tab">
            <h4>2. Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø± Ù…ØªØ­Ø±Ùƒ</h4>
            <input type="file" id="bFile" accept="image/*">
            <button class="menu-btn" style="background:#fff; color:#000" onclick="uploadBanner()">Ø±ÙØ¹ Ø§Ù„Ø¨Ù†Ø±</button>
        </div>
    </div>
</div>

<div class="side-menu" id="sideMenu">
    <div id="guestMode">
        <h3 style="text-align:center">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h3>
        <button class="menu-btn" style="background:var(--main); color:#fff" onclick="openLogin()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
        <button class="menu-btn" style="background:#222; color:#fff" onclick="openSignup()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </div>
    <div id="userMode" class="hidden">
        <h3 id="menuName">--</h3>
        <p id="menuID" style="color:var(--main)"></p>
        <button class="menu-btn" style="background:#00ff00; color:#000" onclick="alert('Ø§Ø±ÙØ¹ Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª Ù„Ù„Ù…Ø¯ÙŠØ±')">Ø´Ø­Ù† Ù…Ø­ÙØ¸ØªÙŠ</button>
        <button class="menu-btn" style="background:#333; color:#fff; margin-top:50px;" onclick="location.reload()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="authModal" class="hidden" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; padding:20px; border-radius:15px; width:90%; z-index:4000; border:1px solid #333;">
    <h3 id="authTitle">Ø¯Ø®ÙˆÙ„</h3>
    <input type="text" id="authName" placeholder="Ø§Ù„Ø§Ø³Ù… (Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙ‚Ø·)">
    <input type="email" id="authEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
    <input type="password" id="authPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="menu-btn" style="background:var(--main); color:#fff" onclick="handleAuth()">ØªØ£ÙƒÙŠØ¯</button>
    <button class="menu-btn" style="background:transparent; color:#fff" onclick="document.getElementById('authModal').classList.add('hidden')">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAalmOWMUhvCi_PuFSUbXRpbe1hmGyer7s",
        authDomain: "karem-store.firebaseapp.com",
        databaseURL: "https://karem-store-default-rtdb.firebaseio.com",
        projectId: "karem-store",
        storageBucket: "karem-store.firebasestorage.app",
        messagingSenderId: "898294902448",
        appId: "1:898294902448:web:23cbee5afd72adcb67d575",
        measurementId: "G-V56WJVTN4J"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    let mode = 'login';
    let foundAgentEmail = '';

    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); document.getElementById('overlay').style.display = document.getElementById('sideMenu').classList.contains('active') ? 'block' : 'none'; }
    function openLogin() { mode='login'; document.getElementById('authModal').classList.remove('hidden'); toggleMenu(); }
    function openSignup() { mode='signup'; document.getElementById('authModal').classList.remove('hidden'); toggleMenu(); }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ---
    function handleAuth() {
        const email = document.getElementById('authEmail').value.replace(/\./g, '_');
        const pass = document.getElementById('authPass').value;
        const name = document.getElementById('authName').value;

        db.ref('users/' + email).once('value', snap => {
            if(mode === 'login') {
                if(snap.exists() && snap.val().pass === pass) login(snap.val());
                else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            } else {
                db.ref('lastID').transaction(c => {
                    const next = (c || 1000) + 1;
                    const u = { name, email, pass, balance:0, uid:next, role:(name==='karem'?'admin':'user') };
                    db.ref('users/'+email).set(u);
                    db.ref('idMap/'+next).set(email);
                    login(u); return next;
                });
            }
        });
    }

    function login(u) {
        currentUser = u;
        document.getElementById('authModal').classList.add('hidden');
        document.getElementById('topUser').classList.remove('hidden');
        document.getElementById('guestMode').classList.add('hidden');
        document.getElementById('userMode').classList.remove('hidden');
        document.getElementById('menuName').innerText = u.name;
        document.getElementById('menuID').innerText = "ID: " + u.uid;
        document.getElementById('uID').innerText = u.uid;
        
        db.ref('users/'+u.email+'/balance').on('value', s => document.getElementById('uBal').innerText = s.val() || 0);
        if(u.role === 'admin' || u.name === 'karem') document.getElementById('adminArea').classList.remove('hidden');
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¯ÙŠØ± ---
    function uploadBanner() {
        const file = document.getElementById('bFile').files[0];
        const r = new FileReader();
        r.onload = e => db.ref('banners').push(e.target.result);
        r.readAsDataURL(file);
        alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨Ù†Ø±!");
    }

    function searchAgent() {
        const id = document.getElementById('targetID').value;
        db.ref('idMap/'+id).once('value', snap => {
            if(!snap.exists()) return alert("ID ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            foundAgentEmail = snap.val();
            db.ref('users/'+foundAgentEmail).once('value', s => {
                document.getElementById('agentFound').classList.remove('hidden');
                document.getElementById('agentName').innerText = "Ø§Ù„ÙˆÙƒÙŠÙ„: " + s.val().name + " (Ø±ØµÙŠØ¯Ù‡: " + s.val().balance + ")";
            });
        });
    }

    function confirmAddMoney() {
        const amt = Number(document.getElementById('addAmt').value);
        db.ref('users/'+foundAgentEmail).once('value', s => {
            db.ref('users/'+foundAgentEmail).update({ balance: (s.val().balance || 0) + amt });
            alert("ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById('agentFound').classList.add('hidden');
        });
    }

    // --- Ø§Ù„Ù…ØªØ¬Ø± (Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø±ÙˆØ¹Ø©) ---
    const products = {
        games: [
            {n: 'Ø¨Ø¨Ø¬ÙŠ 60 Ø´Ø¯Ø©', p: 45, i: 'https://p-u.popcdn.net/event_details/posters/000/006/332/large/c990b76e19069d519b48c66e210134015f848e02.jpg?1566453916'},
            {n: 'ÙØ±ÙŠ ÙØ§ÙŠØ± 100 Ø¬ÙˆÙ‡Ø±Ø©', p: 38, i: 'https://i.pinimg.com/736x/36/c6/33/36c6339097960337c688c2f10134015f.jpg'},
            {n: 'ÙŠÙ„Ø§ Ù„ÙˆØ¯Ùˆ Ø°Ù‡Ø¨', p: 25, i: 'https://play-lh.googleusercontent.com/I2N0q5C88n1_V2_4LpY-8I7C6Y_uJq8D8tV6U-G-B7S-H6_L9U1Z1z1Z1z1Z1z1Z1z1'}
        ],
        apps: [
            {n: 'Ø´Ø§Ù‡Ø¯ VIP Ø´Ù‡Ø±', p: 110, i: 'https://play-lh.googleusercontent.com/9783fD4yD1S1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1'},
            {n: 'Ù†ØªÙÙ„ÙŠÙƒØ³ Ø­Ø³Ø§Ø¨ ÙƒØ§Ù…Ù„', p: 140, i: 'https://play-lh.googleusercontent.com/TBRS_S1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1z1z1z1Z1'}
        ],
        social: [
            {n: '1000 Ù…ØªØ§Ø¨Ø¹ ØªÙŠÙƒ ØªÙˆÙƒ', p: 55, i: 'https://play-lh.googleusercontent.com/OS92WS1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1Z1z1z1z1z1Z1'}
        ]
    };

    function renderStore() {
        const draw = (id, list) => {
            document.getElementById(id).innerHTML = list.map(p => `
                <div class="item-card">
                    <img src="${p.i}">
                    <h4>${p.n}</h4>
                    <b>${p.p} Ø¬</b>
                </div>`).join("");
        };
        draw('gamesGrid', products.games);
        draw('appsGrid', products.apps);
        draw('socialGrid', products.social);
    }

    // --- Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
    db.ref('banners').on('value', snap => {
        const container = document.getElementById('sliderContainer');
        if(snap.exists()) {
            container.innerHTML = "";
            snap.forEach(s => container.innerHTML += `<img src="${s.val()}">`);
        }
    });

    let sIndex = 0;
    setInterval(() => {
        const container = document.getElementById('sliderContainer');
        if(container.children.length > 1) {
            sIndex++;
            if(sIndex >= container.children.length) sIndex = 0;
            container.style.transform = `translateX(${sIndex * 100}%)`;
        }
    }, 3000);

    renderStore();
</script>
</body>
</html>
