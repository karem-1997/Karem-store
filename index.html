<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ultimate Control</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root { --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%); --bg: #050505; --card: #0d0d0d; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .master-title { font-size: 32px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; margin-bottom: 20px; }
        .tabs { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .tab { background: #1a1a1a; color: #888; border: 1px solid #333; padding: 10px 15px; border-radius: 12px; cursor: pointer; font-size: 14px; }
        .tab.active { background: var(--gold); color: #000; border: none; font-weight: bold; }

        .form-card { background: var(--card); border: 1px solid rgba(191,149,63,0.3); border-radius: 25px; padding: 25px; width: 100%; max-width: 460px; display: none; box-shadow: 0 15px 40px rgba(0,0,0,0.8); }
        .copy-box { background: rgba(191,149,63,0.05); border: 1px dashed #bf953f; border-radius: 15px; padding: 12px; text-align: center; margin-bottom: 20px; cursor: pointer; }
        
        .group { margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 6px; font-size: 13px; color: #fcf6ba; font-weight: bold; }
        input, select { width: 100%; background: #151515; border: 1px solid #333; border-radius: 10px; padding: 12px; color: #fff; outline: none; box-sizing: border-box; font-family: 'Tajawal'; }
        
        .res-box { background: rgba(191,149,63,0.08); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #bf953f33; margin: 15px 0; }
        .btn-main { width: 100%; padding: 16px; background: var(--gold); border: none; border-radius: 12px; color: #000; font-size: 18px; font-weight: 900; cursor: pointer; }

        /* Admin Layout */
        #admin { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; padding: 15px; overflow-y: auto; }
        .admin-box { background: #0a0a0a; border: 1px solid #bf953f; border-radius: 20px; max-width: 700px; margin: auto; padding: 20px; }
        .adm-sec { background: #111; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #222; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .v-row { display: grid; grid-template-columns: 1fr 1.5fr 1fr auto; gap: 5px; margin-bottom: 8px; }
        .btn-add { background: #22c55e; color: #000; border: none; padding: 10px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; }
    </style>
</head>
<body>

<h1 class="master-title" onclick="openAdmin()">Helmy Card</h1>
<div class="tabs" id="tabNav"></div>

<div class="form-card" id="ui">
    <div id="u_warn" style="color:#ff4d4d; text-align:center; font-weight:bold; font-size:12px; margin-bottom:10px;"></div>
    <div class="copy-box" onclick="copyId()">
        <span id="label_withdraw_id" style="font-size: 11px; color: #aaa;"></span><br>
        <b id="u_aid" style="font-size:20px;"></b><br>
        <span id="u_aname" style="font-size: 13px; color: gold;"></span>
    </div>

    <div class="group"><label id="lbl_uid"></label><input type="text" id="i_uid"></div>
    <div class="group"><label id="lbl_agent"></label><input type="text" id="i_agent_name"></div>
    <div class="group" id="row_pts" style="display:none;"><label id="lbl_pts"></label><input type="number" id="i_pts" oninput="calculate()"></div>
    
    <div class="group">
        <label id="lbl_method">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</label>
        <select id="i_meth" onchange="toggleVipUI(); calculate();">
            <option value="voda">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
            <option value="etis">Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´</option>
            <option value="oran">Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´</option>
            <option value="general_agent">ÙˆÙƒÙŠÙ„ Ø¹Ø§Ù… (Ø³Ø¹Ø± Ù…ÙˆØ­Ø¯)</option>
            <option value="vip_agent">ÙˆÙƒÙ„Ø§Ø¡ VIP ğŸ”½</option>
        </select>
    </div>

    <div class="group" id="vip_area" style="display:none;">
        <label id="lbl_vip_select">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ</label>
        <select id="i_vips" onchange="calculate()"></select>
    </div>

    <div class="group"><label id="lbl_usd">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</label><input type="number" id="i_usd" placeholder="0.00" oninput="calculate()"></div>

    <div class="res-box">
        <div id="u_rate" style="font-size:11px; color:gold; margin-bottom:5px;"></div>
        <div id="u_egp" style="font-size:26px; font-weight:900;">0.00 Ø¬.Ù…</div>
    </div>

    <div class="group"><label id="lbl_wallet">Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</label><input type="text" id="i_wallet"></div>
    <div class="group"><label id="lbl_file">ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</label><input type="file" id="i_file" accept="image/*"></div>

    <button class="btn-main" onclick="send()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="admin">
    <div class="admin-box">
        <h2 style="color:gold; text-align:center;">âš™ï¸ ØªØ­ÙƒÙ… Ø´Ø§Ù…Ù„ - Helmy Master</h2>
        
        <div class="adm-sec">
            <label>â• Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯</label>
            <div class="grid-2">
                <input type="text" id="new_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
                <button class="btn-add" onclick="createApp()">Ø¥Ø¶Ø§ÙØ© +</button>
            </div>
        </div>

        <div id="editZone" style="display:none;">
            <h3 id="target_title" style="color:gold; border-bottom:1px solid #333; padding-bottom:5px;"></h3>
            
            <div class="adm-sec">
                <label>ğŸ”— Ø§Ù„Ø±Ø¨Ø· ÙˆØ§Ù„Ù€ API</label>
                <input type="text" id="a_sheet" placeholder="Ø±Ø§Ø¨Ø· Google Sheet (SheetDB)" style="margin-bottom:5px;">
                <input type="text" id="a_token" placeholder="Bot Token" style="margin-bottom:5px;">
                <input type="text" id="a_chat" placeholder="Chat ID">
            </div>

            <div class="adm-sec">
                <label>ğŸ·ï¸ ØªØ®ØµÙŠØµ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø®Ø§Ù†Ø§Øª (Labels)</label>
                <div class="grid-2">
                    <input type="text" id="l_uid" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙŠØ¯ÙŠ">
                    <input type="text" id="l_agent" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„ÙˆÙƒÙŠÙ„">
                    <input type="text" id="l_method" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©">
                    <input type="text" id="l_usd" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
                    <input type="text" id="l_wallet" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø©">
                    <input type="text" id="l_file" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„ØµÙˆØ±Ø©">
                    <input type="text" id="l_pts" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø·">
                    <input type="text" id="l_withdraw_id" placeholder="Ø¹Ù†ÙˆØ§Ù† ID Ø§Ù„Ø³Ø­Ø¨">
                </div>
            </div>

            <div class="adm-sec">
                <label>ğŸ’° ØªØ³Ø¹ÙŠØ± Ø·Ø±Ù‚ Ø§Ù„Ø³Ø­Ø¨ (ÙØµÙ„ ÙƒØ§Ù…Ù„)</label>
                <div class="grid-2">
                    <input type="number" step="0.1" id="r_voda" placeholder="Ø³Ø¹Ø± ÙÙˆØ¯Ø§ÙÙˆÙ†">
                    <input type="number" step="0.1" id="r_etis" placeholder="Ø³Ø¹Ø± Ø§ØªØµØ§Ù„Ø§Øª">
                    <input type="number" step="0.1" id="r_oran" placeholder="Ø³Ø¹Ø± Ø£ÙˆØ±Ù†Ø¬">
                    <input type="number" step="0.1" id="r_gen" placeholder="Ø³Ø¹Ø± ÙˆÙƒÙŠÙ„ Ø¹Ø§Ù…">
                </div>
            </div>

            <div class="adm-sec">
                <label>ğŸ’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…Ù„</label>
                <select id="a_mode" onchange="tPtsRow()"><option value="usd">Ø¯ÙˆÙ„Ø§Ø± Ù…Ø¨Ø§Ø´Ø±</option><option value="pts">Ù†Ù‚Ø§Ø· (ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ)</option></select>
                <div id="pts_conf" style="display:none; margin-top:10px;">
                    <input type="number" id="a_prate" placeholder="Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ (ÙƒÙ… Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ 1$)">
                </div>
            </div>

            <div class="adm-sec">
                <label>âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</label>
                <input type="text" id="a_aid" placeholder="ID Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" style="margin-bottom:5px;">
                <input type="text" id="a_aname" placeholder="Ø§Ø³Ù… Ù…Ø³ØªÙ„Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª" style="margin-bottom:5px;">
                <textarea id="a_warn" placeholder="Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ" style="width:100%; background:#151515; color:#fff; border:1px solid #333; border-radius:10px; padding:10px;"></textarea>
            </div>

            <div class="adm-sec">
                <label>ğŸ‘¥ ÙˆÙƒÙ„Ø§Ø¡ VIP (ÙƒÙˆØ¯ | Ø§Ø³Ù… | Ø³Ø¹Ø± Ø®Ø§Øµ)</label>
                <div id="v_list"></div>
                <button class="btn-add" onclick="addVRow()">+ Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ VIP Ø¬Ø¯ÙŠØ¯</button>
            </div>

            <button class="btn-main" onclick="save()">Ø­ÙØ¸ ÙƒØ§ÙØ© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…</button>
            <button onclick="delApp()" style="width:100%; background:#721c24; color:#fff; border:none; padding:10px; margin-top:10px; border-radius:10px; cursor:pointer;">Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ğŸ—‘ï¸</button>
        </div>
        <button onclick="document.getElementById('admin').style.display='none'" style="width:100%; background:#222; border:none; color:#fff; padding:12px; margin-top:10px; cursor:pointer; border-radius:12px;">Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://karak-13101-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let apps = {}; let active = "";

    db.ref('Helmy_Master_v12').on('value', (s) => {
        apps = s.val() || {};
        renderTabs();
        if(!active && Object.keys(apps).length > 0) selectApp(Object.keys(apps)[0]);
        else if(active) selectApp(active);
    });

    function renderTabs() {
        const nav = document.getElementById('tabNav'); nav.innerHTML = '';
        for(let n in apps) {
            const b = document.createElement('button');
            b.className = `tab ${active === n ? 'active' : ''}`;
            b.innerText = n; b.onclick = () => selectApp(n); nav.appendChild(b);
        }
    }

    function selectApp(n) {
        active = n; const d = apps[n];
        document.getElementById('ui').style.display = 'block';
        document.getElementById('u_warn').innerText = d.warn || "";
        document.getElementById('u_aid').innerText = d.aid || "";
        document.getElementById('u_aname').innerText = d.aname || "";
        
        // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø³Ù…ÙŠØ§Øª Ø§Ù„Ø®Ø§Ù†Ø§Øª
        document.getElementById('label_withdraw_id').innerText = d.labels?.withdraw_id || "ID Ø³Ø­Ø¨";
        document.getElementById('lbl_uid').innerText = d.labels?.uid || "Ø§Ù„Ø£ÙŠØ¯ÙŠ";
        document.getElementById('lbl_agent').innerText = d.labels?.agent || "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„";
        document.getElementById('lbl_method').innerText = d.labels?.method || "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨";
        document.getElementById('lbl_usd').innerText = d.labels?.usd || "Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±";
        document.getElementById('lbl_wallet').innerText = d.labels?.wallet || "Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©";
        document.getElementById('lbl_file').innerText = d.labels?.file || "ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„";
        document.getElementById('lbl_pts').innerText = d.labels?.pts || "Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·";

        document.getElementById('row_pts').style.display = d.mode === 'pts' ? 'block' : 'none';
        document.getElementById('i_usd').readOnly = d.mode === 'pts';
        
        const sel = document.getElementById('i_vips'); sel.innerHTML = '<option value="gen">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒÙŠÙ„ --</option>';
        if(d.agents) for(let id in d.agents) { 
            let o = document.createElement('option'); o.value=id; o.text=`${d.agents[id].name} (${id})`; sel.add(o); 
        }
        renderTabs(); calculate();
    }

    function calculate() {
        const d = apps[active]; if(!d) return;
        if(d.mode === 'pts') {
            let p = parseFloat(document.getElementById('i_pts').value) || 0;
            document.getElementById('i_usd').value = (p / (d.prate || 1)).toFixed(2);
        }
        let usd = parseFloat(document.getElementById('i_usd').value) || 0;
        let m = document.getElementById('i_meth').value;
        
        let rate = d.rates?.voda || 0;
        if(m === 'etis') rate = d.rates?.etis || 0;
        else if(m === 'oran') rate = d.rates?.oran || 0;
        else if(m === 'general_agent') rate = d.rates?.gen || 0;
        else if(m === 'vip_agent') {
            let v = document.getElementById('i_vips').value;
            rate = (v !== 'gen' && d.agents[v]) ? d.agents[v].price : (d.rates?.gen || 0);
        }

        document.getElementById('u_rate').innerText = "Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ: " + rate;
        document.getElementById('u_egp').innerText = (usd * rate).toFixed(2) + " Ø¬.Ù…";
        return (usd * rate).toFixed(2);
    }

    function toggleVipUI() { document.getElementById('vip_area').style.display = (document.getElementById('i_meth').value === 'vip_agent') ? 'block' : 'none'; }
    function tPtsRow() { document.getElementById('pts_conf').style.display = (document.getElementById('a_mode').value === 'pts') ? 'block' : 'none'; }
    function openAdmin() { if(prompt("Password:") === "1997") { document.getElementById('admin').style.display='block'; loadAdm(); } }

    function loadAdm() {
        const d = apps[active]; if(!d) return;
        document.getElementById('target_title').innerText = "Ø¥Ø¯Ø§Ø±Ø© Ù†Ø¸Ø§Ù…: " + active;
        document.getElementById('a_sheet').value = d.sheet||""; document.getElementById('a_token').value = d.token||"";
        document.getElementById('a_chat').value = d.chatid||""; document.getElementById('a_aid').value = d.aid||"";
        document.getElementById('a_aname').value = d.aname||""; document.getElementById('a_warn').value = d.warn||"";
        
        // Ø§Ù„Ø®Ø§Ù†Ø§Øª
        document.getElementById('l_uid').value = d.labels?.uid || "";
        document.getElementById('l_agent').value = d.labels?.agent || "";
        document.getElementById('l_method').value = d.labels?.method || "";
        document.getElementById('l_usd').value = d.labels?.usd || "";
        document.getElementById('l_wallet').value = d.labels?.wallet || "";
        document.getElementById('l_file').value = d.labels?.file || "";
        document.getElementById('l_pts').value = d.labels?.pts || "";
        document.getElementById('l_withdraw_id').value = d.labels?.withdraw_id || "";

        // Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
        document.getElementById('r_voda').value = d.rates?.voda || "";
        document.getElementById('r_etis').value = d.rates?.etis || "";
        document.getElementById('r_oran').value = d.rates?.oran || "";
        document.getElementById('r_gen').value = d.rates?.gen || "";

        document.getElementById('a_mode').value = d.mode || "usd";
        document.getElementById('a_prate').value = d.prate || "";
        
        tPtsRow(); const list = document.getElementById('v_list'); list.innerHTML = '';
        if(d.agents) for(let id in d.agents) addVRow(id, d.agents[id].name, d.agents[id].price);
        document.getElementById('editZone').style.display = 'block';
    }

    function addVRow(id="", n="", p="") {
        const div = document.createElement('div'); div.className='v-row';
        div.innerHTML = `<input type="text" class="v-i" value="${id}" placeholder="ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„"><input type="text" class="v-n" value="${n}" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„"><input type="number" class="v-p" value="${p}" placeholder="Ø³Ø¹Ø± Ø®Ø§Øµ"><button onclick="this.parentElement.remove()" style="background:red; color:#fff; border:none; border-radius:5px;">X</button>`;
        document.getElementById('v_list').appendChild(div);
    }

    function createApp() { 
        const n = document.getElementById('new_name').value; 
        if(n) db.ref('Helmy_Master_v12/'+n).set({
            rates: {voda:45, etis:45, oran:45, gen:46},
            labels: {uid: "Ø§Ù„Ø£ÙŠØ¯ÙŠ", agent: "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„", method: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨", usd: "Ø§Ù„Ù…Ø¨Ù„Øº ($)", wallet: "Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©", file: "ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„", pts: "Ø§Ù„Ù†Ù‚Ø§Ø·", withdraw_id: "ID Ø³Ø­Ø¨"},
            aid: "0000", mode: "usd"
        }); 
    }

    function save() {
        let ags = {}; document.querySelectorAll('.v-row').forEach(r => {
            let id=r.querySelector('.v-i').value;
            if(id) ags[id]={name:r.querySelector('.v-n').value, price:parseFloat(r.querySelector('.v-p').value)};
        });
        db.ref('Helmy_Master_v12/'+active).update({
            sheet: document.getElementById('a_sheet').value, token: document.getElementById('a_token').value,
            chatid: document.getElementById('a_chat').value, aid: document.getElementById('a_aid').value,
            aname: document.getElementById('a_aname').value, warn: document.getElementById('a_warn').value,
            mode: document.getElementById('a_mode').value, prate: parseFloat(document.getElementById('a_prate').value),
            labels: {
                uid: document.getElementById('l_uid').value, agent: document.getElementById('l_agent').value,
                method: document.getElementById('l_method').value, usd: document.getElementById('l_usd').value,
                wallet: document.getElementById('l_wallet').value, file: document.getElementById('l_file').value,
                pts: document.getElementById('l_pts').value, withdraw_id: document.getElementById('l_withdraw_id').value
            },
            rates: {
                voda: parseFloat(document.getElementById('r_voda').value),
                etis: parseFloat(document.getElementById('r_etis').value),
                oran: parseFloat(document.getElementById('r_oran').value),
                gen: parseFloat(document.getElementById('r_gen').value)
            },
            agents: ags
        }).then(() => alert("ØªÙ… Ø­ÙØ¸ ÙƒØ§ÙØ© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…"));
    }

    async function send() {
        const f = document.getElementById('i_file').files[0]; const uid = document.getElementById('i_uid').value; const config = apps[active];
        if(!f || !uid || !config.token) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©!");
        const egp = calculate(); const now = new Date();
        const day = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"][now.getDay()];
        const date = now.toLocaleDateString('en-GB'); 
        
        let finalAgent = document.getElementById('i_agent_name').value || "ØºÙŠØ± Ù…Ø³Ø¬Ù„";
        let methodText = document.getElementById('i_meth').options[document.getElementById('i_meth').selectedIndex].text;
        
        if(document.getElementById('i_meth').value === 'vip_agent') {
            let v = document.getElementById('i_vips').value;
            if(v !== 'gen') finalAgent = config.agents[v].name;
        }

        // Ø¥Ø±Ø³Ø§Ù„ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        const fd = new FormData(); fd.append('chat_id', config.chatid); fd.append('photo', f);
        fd.append('caption', `ğŸ§¾ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯ (${active})\nâ”â”â”â”â”â”â”â”â”â”â”â”\nğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${uid}\nğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${finalAgent}\nğŸ’µ Ø¯ÙˆÙ„Ø§Ø±: ${document.getElementById('i_usd').value}$\nğŸ‡ªğŸ‡¬ Ù…ØµØ±ÙŠ: ${egp}\nğŸ’³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: ${methodText}\nğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${document.getElementById('i_wallet').value}\nğŸ“… Ø§Ù„ÙŠÙˆÙ…: ${day}\nâ° Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}`);
        fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, { method: 'POST', body: fd });

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙƒØ³Ù„ (Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù€ 8 Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©)
        if(config.sheet) {
            fetch(config.sheet, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ data: [{
                    "Ø§Ù„Ø£ÙŠØ¯ÙŠ": uid, "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„": finalAgent, "Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±": document.getElementById('i_usd').value,
                    "Ø§Ù„Ù…ØµØ±ÙŠ": egp, "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨": methodText, "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©": "'" + document.getElementById('i_wallet').value,
                    "Ø§Ù„ÙŠÙˆÙ…": day, "Ø§Ù„ØªØ§Ø±ÙŠØ®": date
                }]})
            });
        }
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…"); location.reload();
    }
    function copyId() { navigator.clipboard.writeText(document.getElementById('u_aid').innerText); alert("ØªÙ… Ù†Ø³Ø® ID Ø§Ù„Ø³Ø­Ø¨ âœ…"); }
    function delApp() { if(confirm("Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) db.ref('Helmy_Master_v12/'+active).remove(); }
</script>
</body>
</html>
