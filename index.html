<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root { --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%); --bg: #050505; --card: #0d0d0d; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        .master-title { font-size: 35px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; margin: 20px 0; }
        
        .tabs { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 25px; }
        .tab { background: #1a1a1a; color: #888; border: 1px solid #333; padding: 10px 18px; border-radius: 12px; cursor: pointer; transition: 0.3s; }
        .tab.active { background: var(--gold); color: #000; border: none; font-weight: bold; }

        .main-card { background: var(--card); border: 1px solid rgba(191,149,63,0.3); border-radius: 25px; padding: 25px; width: 100%; max-width: 450px; display: none; box-shadow: 0 15px 35px rgba(0,0,0,0.8); }
        .copy-area { background: rgba(191,149,63,0.05); border: 1px dashed #bf953f; border-radius: 15px; padding: 12px; text-align: center; margin-bottom: 20px; cursor: pointer; }
        
        .group { margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 6px; font-size: 13px; color: #fcf6ba; font-weight: bold; }
        input, select { width: 100%; background: #151515; border: 1px solid #333; border-radius: 10px; padding: 12px; color: #fff; outline: none; box-sizing: border-box; }
        
        .res-box { background: rgba(191,149,63,0.05); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #222; margin: 15px 0; }
        .btn-send { width: 100%; padding: 15px; background: var(--gold); border: none; border-radius: 12px; color: #000; font-size: 18px; font-weight: 900; cursor: pointer; }

        /* Admin Panel */
        #admin { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; padding: 15px; overflow-y: auto; }
        .admin-box { background: #0a0a0a; border: 1px solid #bf953f; border-radius: 20px; max-width: 600px; margin: auto; padding: 20px; }
        .adm-sec { background: #111; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #222; }
        .v-row { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 5px; margin-bottom: 8px; }
        .btn-add { background: #22c55e; color: #000; border: none; padding: 10px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<h1 class="master-title" onclick="openAdmin()">Helmy Card</h1>
<div class="tabs" id="tabNav"></div>

<div class="main-card" id="ui">
    <div id="u_warn" style="color:red; text-align:center; font-weight:bold; font-size:12px; margin-bottom:10px;"></div>
    <div class="copy-area" onclick="copyId()">
        <small>ID Ø§Ù„Ø³Ø­Ø¨ (Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø®)</small><br>
        <b id="u_aid" style="font-size:20px;"></b><br>
        <small id="u_aname"></small>
    </div>

    <div class="group"><label id="l_uid">Ø§Ù„Ø£ÙŠØ¯ÙŠ</label><input type="text" id="i_uid"></div>
    <div class="group" id="row_pts" style="display:none;"><label id="l_pts">Ø§Ù„Ù†Ù‚Ø§Ø·</label><input type="number" id="i_pts" oninput="calc()"></div>
    
    <div class="group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</label>
        <select id="i_meth" onchange="toggleAgentUI(); calc();">
            <option value="cash">ÙƒØ§Ø´ (ÙÙˆØ¯Ø§ÙÙˆÙ†/Ø§ØªØµØ§Ù„Ø§Øª/Ø£ÙˆØ±Ù†Ø¬)</option>
            <option value="vip">ÙˆÙƒÙ„Ø§Ø¡ VIP ğŸ”½</option>
        </select>
    </div>

    <div class="group" id="vip_area" style="display:none;">
        <label>Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <select id="i_vips" onchange="calc()"></select>
    </div>

    <div class="group"><label>Ø§Ù„Ù…Ø¨Ù„Øº ($)</label><input type="number" id="i_usd" oninput="calc()"></div>

    <div class="res-box">
        <div id="u_rate" style="font-size:11px; color:gold;">Ø§Ù„Ø³Ø¹Ø±: 0</div>
        <div id="u_egp" style="font-size:24px; font-weight:900;">0.00 Ø¬.Ù…</div>
    </div>

    <div class="group"><label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</label><input type="text" id="i_wallet" placeholder="01xxxxxxxxx"></div>
    <div class="group"><label>Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</label><input type="file" id="i_file" accept="image/*"></div>

    <button class="btn-send" onclick="send()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="admin">
    <div class="admin-box">
        <h2 style="color:gold; text-align:center;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù†Ø¸Ù…Ø©</h2>
        
        <div class="adm-sec">
            <label>â• Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Ø¬Ø¯ÙŠØ¯</label>
            <input type="text" id="new_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
            <button class="btn-add" style="margin-top:8px;" onclick="createApp()">Ø¥Ù†Ø´Ø§Ø¡</button>
        </div>

        <div id="editZone" style="display:none;">
            <h3 id="target_title" style="color:gold;"></h3>
            
            <div class="adm-sec">
                <label>ğŸŒ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø±Ø¨Ø·</label>
                <input type="text" id="a_token" placeholder="Ø¨ÙˆØª ØªÙˆÙƒÙ†" style="margin-bottom:5px;">
                <input type="text" id="a_chat" placeholder="Chat ID" style="margin-bottom:5px;">
                <input type="text" id="a_sheet" placeholder="Ø±Ø§Ø¨Ø· SheetDB">
            </div>

            <div class="adm-sec">
                <label>ğŸ“ Ù†ØµÙˆØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</label>
                <input type="text" id="a_luid" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙŠØ¯ÙŠ" style="margin-bottom:5px;">
                <input type="text" id="a_warn" placeholder="Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ±" style="margin-bottom:5px;">
                <input type="text" id="a_aid" placeholder="ID Ø§Ù„Ø³Ø­Ø¨" style="margin-bottom:5px;">
                <input type="text" id="a_aname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…">
            </div>

            <div class="adm-sec">
                <label>ğŸ’ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·</label>
                <select id="a_mode" onchange="tPtsRow()"><option value="usd">Ø¯ÙˆÙ„Ø§Ø± Ù…Ø¨Ø§Ø´Ø±</option><option value="pts">Ù†Ù‚Ø§Ø·</option></select>
                <div id="pts_conf" style="display:none; margin-top:10px;">
                    <input type="text" id="a_lpts" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø·" style="margin-bottom:5px;">
                    <input type="number" id="a_prate" placeholder="ÙƒÙ„ ÙƒÙ… Ù†Ù‚Ø·Ø© = 1 Ø¯ÙˆÙ„Ø§Ø±ØŸ">
                </div>
            </div>

            <div class="adm-sec">
                <label>ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ø§Ù…Ø©</label>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <input type="number" step="0.1" id="a_rv" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø´">
                    <input type="number" step="0.1" id="a_ra" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙŠÙ„">
                </div>
            </div>

            <div class="adm-sec">
                <label>ğŸ‘¥ ÙˆÙƒÙ„Ø§Ø¡ VIP (ID | Ø§Ø³Ù… | Ø³Ø¹Ø±)</label>
                <div id="v_list"></div>
                <button onclick="addVRow()" style="background:#333; color:#fff; border:none; padding:8px; width:100%; cursor:pointer;">+ Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„</button>
            </div>

            <button class="btn-send" onclick="save()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…</button>
            <button onclick="delApp()" style="width:100%; background:red; color:#fff; border:none; padding:10px; margin-top:10px; border-radius:10px;">Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ğŸ—‘ï¸</button>
        </div>
        <button onclick="document.getElementById('admin').style.display='none'" style="width:100%; background:#222; border:none; color:#fff; padding:12px; margin-top:10px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://karak-13101-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let apps = {}; let active = "";

    db.ref('Master_Helmy_V10').on('value', (s) => {
        apps = s.val() || {};
        renderTabs();
        if(!active && Object.keys(apps).length > 0) selectApp(Object.keys(apps)[0]);
        else if(active) selectApp(active);
    });

    function renderTabs() {
        const nav = document.getElementById('tabNav'); nav.innerHTML = '';
        for(let n in apps) {
            const b = document.createElement('button');
            b.className = `tab ${active === n ? 'active' : ''}`;
            b.innerText = n; b.onclick = () => selectApp(n); nav.appendChild(b);
        }
    }

    function selectApp(n) {
        active = n; const d = apps[n];
        document.getElementById('ui').style.display = 'block';
        document.getElementById('u_warn').innerText = d.warn || "";
        document.getElementById('u_aid').innerText = d.aid || "";
        document.getElementById('u_aname').innerText = d.aname || "";
        document.getElementById('l_uid').innerText = d.luid || "Ø§Ù„Ø£ÙŠØ¯ÙŠ";
        document.getElementById('row_pts').style.display = d.mode==='pts'?'block':'none';
        if(d.mode==='pts') { document.getElementById('l_pts').innerText = d.lpts; document.getElementById('i_usd').readOnly = true; }
        else { document.getElementById('i_usd').readOnly = false; }
        
        const sel = document.getElementById('i_vips'); sel.innerHTML = '<option value="gen">Ø³Ø¹Ø± ÙˆÙƒÙŠÙ„ Ø¹Ø§Ù…</option>';
        if(d.agents) for(let id in d.agents) { let o = document.createElement('option'); o.value=id; o.text=`${d.agents[id].name} (${id})`; sel.add(o); }
        renderTabs(); calc();
    }

    function calc() {
        const d = apps[active]; if(!d) return;
        if(d.mode==='pts') { let p = parseFloat(document.getElementById('i_pts').value)||0; document.getElementById('i_usd').value = (p/(d.prate||1)).toFixed(2); }
        let usd = parseFloat(document.getElementById('i_usd').value)||0;
        let m = document.getElementById('i_meth').value;
        let r = d.rv; if(m==='vip') { let v = document.getElementById('i_vips').value; r = (v!=='gen'&&d.agents[v])?d.agents[v].price:d.ra; }
        document.getElementById('u_rate').innerText = "Ø§Ù„Ø³Ø¹Ø±: "+r;
        document.getElementById('u_egp').innerText = (usd*r).toFixed(2)+" Ø¬.Ù…";
        return (usd*r).toFixed(2);
    }

    function toggleAgentUI() { document.getElementById('vip_area').style.display = (document.getElementById('i_meth').value==='vip')?'block':'none'; }
    function tPtsRow() { document.getElementById('pts_conf').style.display = (document.getElementById('a_mode').value==='pts')?'block':'none'; }
    function openAdmin() { if(prompt("Pass:")==="1997") { document.getElementById('admin').style.display='block'; loadAdm(); } }

    function loadAdm() {
        const d = apps[active]; if(!d) return;
        document.getElementById('target_title').innerText = "ØªØ¹Ø¯ÙŠÙ„: " + active;
        document.getElementById('a_token').value = d.token||""; document.getElementById('a_chat').value = d.chatid||"";
        document.getElementById('a_sheet').value = d.sheet||""; document.getElementById('a_luid').value = d.luid||"";
        document.getElementById('a_warn').value = d.warn||""; document.getElementById('a_aid').value = d.aid||"";
        document.getElementById('a_aname').value = d.aname||""; document.getElementById('a_rv').value = d.rv||"";
        document.getElementById('a_ra').value = d.ra||""; document.getElementById('a_mode').value = d.mode||"usd";
        document.getElementById('a_lpts').value = d.lpts||""; document.getElementById('a_prate').value = d.prate||"";
        tPtsRow(); const list = document.getElementById('v_list'); list.innerHTML = '';
        if(d.agents) for(let id in d.agents) addVRow(id, d.agents[id].name, d.agents[id].price);
        document.getElementById('editZone').style.display = 'block';
    }

    function addVRow(id="", n="", p="") {
        const div = document.createElement('div'); div.className='v-row';
        div.innerHTML = `<input type="text" class="v-i" value="${id}" placeholder="ID"><input type="text" class="v-n" value="${n}" placeholder="Ø§Ø³Ù…"><input type="number" class="v-p" value="${p}" placeholder="Ø³Ø¹Ø±"><button onclick="this.parentElement.remove()">X</button>`;
        document.getElementById('v_list').appendChild(div);
    }

    function createApp() { const n = document.getElementById('new_name').value; if(n) db.ref('Master_Helmy_V10/'+n).set({rv:45, ra:46, aid:"000", mode:"usd", luid:"Ø§Ù„Ø£ÙŠØ¯ÙŠ"}); }

    function save() {
        let ags = {}; document.querySelectorAll('.v-row').forEach(r => { let id=r.querySelector('.v-i').value; if(id) ags[id]={name:r.querySelector('.v-n').value, price:parseFloat(r.querySelector('.v-p').value)}; });
        db.ref('Master_Helmy_V10/'+active).update({
            token: document.getElementById('a_token').value, chatid: document.getElementById('a_chat').value,
            sheet: document.getElementById('a_sheet').value, luid: document.getElementById('a_luid').value,
            warn: document.getElementById('a_warn').value, aid: document.getElementById('a_aid').value,
            aname: document.getElementById('a_aname').value, rv: parseFloat(document.getElementById('a_rv').value),
            ra: parseFloat(document.getElementById('a_ra').value), mode: document.getElementById('a_mode').value,
            lpts: document.getElementById('a_lpts').value, prate: document.getElementById('a_prate').value,
            agents: ags
        }).then(() => alert("Saved!"));
    }

    async function send() {
        const f = document.getElementById('i_file').files[0]; const uid = document.getElementById('i_uid').value; const config = apps[active];
        if(!f || !uid || !config.token) return alert("Missing Data!");
        const egp = calc(); const now = new Date(); const day = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"][now.getDay()];
        const date = now.toLocaleDateString('en-GB'); let agName = "ÙƒØ§Ø´";
        if(document.getElementById('i_meth').value==='vip') { let v = document.getElementById('i_vips').value; agName = (v!=='gen')?config.agents[v].name:"ÙˆÙƒÙŠÙ„ Ø¹Ø§Ù…"; }

        // Telegram
        const fd = new FormData(); fd.append('chat_id', config.chatid); fd.append('photo', f);
        fd.append('caption', `ğŸ“¦ Ø·Ù„Ø¨: ${active}\nğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${uid}\nğŸ‘¤ Ø§Ù„ÙˆÙƒÙŠÙ„: ${agName}\nğŸ’µ Ø¯ÙˆÙ„Ø§Ø±: ${document.getElementById('i_usd').value}$\nğŸ‡ªğŸ‡¬ Ù…ØµØ±ÙŠ: ${egp}\nğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${document.getElementById('i_wallet').value}\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}`);
        fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, { method: 'POST', body: fd });

        // Excel
        fetch(config.sheet, { method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ data: [{ "Ø§Ù„Ø£ÙŠØ¯ÙŠ": uid, "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„": agName, "Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±": document.getElementById('i_usd').value, "Ø§Ù„Ù…ØµØ±ÙŠ": egp, "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨": document.getElementById('i_meth').value, "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©": "'" + document.getElementById('i_wallet').value, "Ø§Ù„ÙŠÙˆÙ…": day, "Ø§Ù„ØªØ§Ø±ÙŠØ®": date }]})
        });
        alert("Success âœ…"); location.reload();
    }
    function copyId() { navigator.clipboard.writeText(document.getElementById('u_aid').innerText); alert("Copied!"); }
    function delApp() { if(confirm("Delete?")) db.ref('Master_Helmy_V10/'+active).remove(); }
</script>
</body>
</html>
