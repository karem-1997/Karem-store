<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAREM STORE | THE MASTER</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --main: #ff0000; --bg: #000; --card: #0e0e0e; --green: #00ff00; --gray: #1a1a1a; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: #fff; margin: 0; padding-bottom: 80px; overflow-x: hidden; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: #000; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--main); position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 900; font-size: 1.5rem; color: var(--main); text-shadow: 0 0 10px var(--main); cursor: pointer; }

        /* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± */
        .slider { width: 95%; height: 160px; margin: 10px auto; border-radius: 15px; overflow: hidden; border: 1px solid var(--gray); }
        .slides { display: flex; height: 100%; }
        .slides img { min-width: 100%; object-fit: cover; }

        /* Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„ÙˆÙƒÙŠÙ„ */
        .u-card { background: var(--card); margin: 15px; padding: 15px; border-radius: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid var(--gray); border-right: 4px solid var(--main); }
        .u-card img { width: 55px; height: 55px; border-radius: 50%; object-fit: cover; border: 2px solid var(--main); }
        .u-info h3 { margin: 0; font-size: 1rem; }
        .u-info p { margin: 5px 0 0; color: var(--green); font-weight: bold; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .grid-cats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; }
        .cat-box { background: var(--card); border-radius: 15px; padding: 20px; text-align: center; border: 1px solid var(--gray); cursor: pointer; }
        .cat-box:hover { border-color: var(--main); background: #150000; }
        .cat-box i { font-size: 2.5rem; color: var(--main); margin-bottom: 10px; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .grid-prods { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
        .prod-box { background: var(--card); border-radius: 12px; padding: 8px; text-align: center; border: 1px solid var(--gray); }
        .prod-box img { width: 100%; aspect-ratio: 1/1; border-radius: 8px; object-fit: cover; }
        .prod-box h4 { font-size: 0.75rem; margin: 5px 0; height: 32px; overflow: hidden; }
        .prod-box b { color: var(--green); font-size: 0.85rem; }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± */
        .adm-panel { background: #050505; border: 1px solid var(--main); margin: 15px; padding: 15px; border-radius: 20px; box-shadow: 0 0 20px rgba(255,0,0,0.1); }
        .tabs { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 15px; padding-bottom: 5px; }
        .tab-btn { background: var(--gray); color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 0.75rem; white-space: nowrap; cursor: pointer; }
        .tab-btn.active { background: var(--main); }

        /* ÙÙˆØ±Ù…Ø§Øª */
        input, select { width: 100%; padding: 12px; margin: 6px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 10px; }
        .btn { width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; margin-top: 5px; }
        .btn-main { background: var(--main); color: #fff; }
        .btn-green { background: var(--green); color: #000; }
        .btn-del { background: #ff3333; color: #fff; padding: 4px 8px; border-radius: 5px; font-size: 0.7rem; border: none; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: #0a0a0a; width: 100%; max-width: 450px; padding: 25px; border-radius: 25px; border: 1px solid #333; }

        /* Ù„Ø³ØªØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #111; margin-bottom: 5px; border-radius: 8px; border-left: 3px solid var(--main); }

        .hidden { display: none !important; }
        #back { background: var(--gray); color: #fff; padding: 8px 15px; border-radius: 10px; margin: 10px 15px; display: inline-block; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="location.reload()">KAREM STORE</div>
    <div id="topUser" class="hidden"><img id="hImg" src="" style="width:35px; height:35px; border-radius:50%; border:1px solid var(--main)"></div>
    <i class="fa-solid fa-user-shield" style="font-size: 1.4rem;" onclick="openAuth()"></i>
</header>

<div class="slider"><div class="slides" id="slideBox"></div></div>

<div id="uArea" class="hidden">
    <div class="u-card">
        <img id="uImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <div class="u-info">
            <h3 id="un">--</h3>
            <p><span id="ub">0</span> Ø¬</p>
            <small id="ui" style="color:#888"></small>
        </div>
    </div>
</div>

<div id="admArea" class="hidden">
    <div class="adm-panel">
        <h3 style="color:var(--main); margin:0 0 10px;">ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</h3>
        <div class="tabs">
            <button class="tab-btn active" onclick="tab('t1')">Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…</button>
            <button class="tab-btn" onclick="tab('t2')">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
            <button class="tab-btn" onclick="tab('t3')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
            <button class="tab-btn" onclick="tab('t4')">Ø´Ø­Ù† Ø±ØµÙŠØ¯</button>
        </div>

        <div id="t1" class="t-c">
            <input type="text" id="cn" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…">
            <input type="text" id="ci" placeholder="Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ù…Ø«Ù„: fa-gamepad)">
            <button class="btn btn-main" onclick="addCat()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø³Ù…</button>
        </div>

        <div id="t2" class="t-c hidden">
            <select id="cp"></select>
            <input type="text" id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="pp" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©">
            <input type="file" id="pf" accept="image/*">
            <button class="btn btn-main" onclick="addProd()">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>

        <div id="t3" class="t-c hidden">
            <div style="background:#111; padding:10px; border-radius:10px; margin-bottom:15px;">
                <h4 style="margin:0 0 10px;">â• Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯Ù…Ù† Ø¬Ø¯ÙŠØ¯</h4>
                <input type="text" id="an" placeholder="Ø§Ù„Ø§Ø³Ù…">
                <input type="email" id="ae" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
                <input type="password" id="ap" placeholder="Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯">
                <button class="btn btn-green" onclick="createAdmin()">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø£Ø¯Ù…Ù†</button>
            </div>
            <h4 style="color:var(--main)">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:</h4>
            <div id="usersList" style="max-height:200px; overflow-y:auto;"></div>
        </div>

        <div id="t4" class="t-c hidden">
            <input type="number" id="sid" placeholder="ID Ø§Ù„ÙˆÙƒÙŠÙ„">
            <button class="btn btn-green" onclick="findU()">Ø¨Ø­Ø«</button>
            <div id="res" class="hidden">
                <p id="rt"></p>
                <input type="number" id="ra" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <button class="btn btn-green" onclick="charge()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</button>
            </div>
        </div>
    </div>
</div>

<div id="viewCats">
    <div class="grid-cats" id="catsBox"></div>
</div>

<div id="viewProds" class="hidden">
    <div id="back" onclick="goBack()"><i class="fa-solid fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</div>
    <h3 id="catTitle" style="padding:0 20px; color:var(--main)"></h3>
    <div class="grid-prods" id="prodsBox"></div>
</div>

<div id="buyModal" class="modal">
    <div class="modal-content">
        <h3 id="bt"></h3>
        <p>Ø§Ù„Ø³Ø¹Ø±: <span id="bp"></span> Ø¬</p>
        <input type="number" id="bq" value="1" min="1" oninput="calc()">
        <h2 style="color:var(--green)">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="btot">0</span> Ø¬</h2>
        <div id="bAct"></div>
        <button class="btn" onclick="closeM('buyModal')" style="background:#222; color:#fff; margin-top:10px;">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="authModal" class="modal">
    <div class="modal-content">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
        <input type="text" id="rn" placeholder="Ø§Ù„Ø§Ø³Ù… (Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯)">
        <input type="email" id="re" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
        <input type="password" id="rp" placeholder="Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯">
        <button class="btn btn-main" onclick="auth()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†</button>
        <button class="btn" onclick="closeM('authModal')" style="background:transparent">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
    const firebaseConfig = {
        apiKey: "AIzaSyAalmOWMUhvCi_PuFSUbXRpbe1hmGyer7s",
        authDomain: "karem-store.firebaseapp.com",
        databaseURL: "https://karem-store-default-rtdb.firebaseio.com",
        projectId: "karem-store",
        storageBucket: "karem-store.firebasestorage.app",
        messagingSenderId: "898294902448",
        appId: "1:898294902448:web:23cbee5afd72adcb67d575"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let user = null; let selP = null; let tMail = '';

    function closeM(id) { document.getElementById(id).classList.remove('active'); }
    function openAuth() { document.getElementById('authModal').classList.add('active'); }
    function tab(id) {
        document.querySelectorAll('.t-c').forEach(t=>t.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        event.target.classList.add('active');
    }
    function goBack() { document.getElementById('viewCats').classList.remove('hidden'); document.getElementById('viewProds').classList.add('hidden'); }

    // --- Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
    function auth() {
        const e = document.getElementById('re').value.replace(/\./g, '_').toLowerCase();
        const p = document.getElementById('rp').value;
        const n = document.getElementById('rn').value;

        if(e === 'admin@karem_com' && p === '123456') {
            login({ name: 'ÙƒØ±ÙŠÙ… (Ø§Ù„Ù…Ø¯ÙŠØ±)', email: e, uid: '1001', role: 'admin', balance: 999999 }); return;
        }

        db.ref('users/'+e).once('value', s => {
            if(s.exists()) {
                if(s.val().pass === p) login(s.val());
                else alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø®Ø·Ø£");
            } else {
                db.ref('lastID').transaction(c => {
                    const id = (c || 1000) + 1;
                    const u = { name: n, email: e, pass: p, balance: 0, uid: id, role: 'user' };
                    db.ref('users/'+e).set(u);
                    db.ref('idMap/'+id).set(e);
                    login(u); return id;
                });
            }
        });
    }

    function login(d) {
        user = d; closeM('authModal');
        document.getElementById('topUser').classList.remove('hidden');
        document.getElementById('uArea').classList.remove('hidden');
        document.getElementById('un').innerText = d.name;
        document.getElementById('ui').innerText = "ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„: " + d.uid;
        db.ref('users/'+d.email+'/balance').on('value', s => {
            user.balance = s.val() || 0;
            document.getElementById('ub').innerText = user.balance;
        });
        if(d.role === 'admin') {
            document.getElementById('admArea').classList.remove('hidden');
            loadUsers();
        }
        loadCats();
    }

    function createAdmin() {
        const e = document.getElementById('ae').value.replace(/\./g, '_').toLowerCase();
        const p = document.getElementById('ap').value;
        const n = document.getElementById('an').value;
        db.ref('users/'+e).set({ name: n, email: e, pass: p, balance: 0, role: 'admin', uid: 'Admin' });
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ù†Ø¬Ø§Ø­");
    }

    function loadUsers() {
        db.ref('users').on('value', s => {
            const list = document.getElementById('usersList'); list.innerHTML = "";
            s.forEach(u => {
                const ud = u.val();
                list.innerHTML += `<div class="user-row">
                    <span>${ud.name} (${ud.role})</span>
                    <button class="btn-del" onclick="deleteUser('${ud.email}')">Ø­Ø°Ù</button>
                </div>`;
            });
        });
    }

    function deleteUser(em) { if(confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) db.ref('users/'+em).remove(); }

    // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
    function addCat() {
        const n = document.getElementById('cn').value;
        const i = document.getElementById('ci').value || 'fa-box';
        db.ref('categories').push({ name: n, icon: i }); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
    }

    function loadCats() {
        db.ref('categories').on('value', s => {
            const box = document.getElementById('catsBox'); box.innerHTML = "";
            const sel = document.getElementById('cp'); sel.innerHTML = "";
            s.forEach(c => {
                const cd = c.val();
                box.innerHTML += `<div class="cat-box" onclick="openCat('${c.key}', '${cd.name}')">
                    <i class="fa-solid ${cd.icon}"></i><h3>${cd.name}</h3>
                </div>`;
                sel.innerHTML += `<option value="${c.key}">${cd.name}</option>`;
            });
        });
    }

    function addProd() {
        const c = document.getElementById('cp').value;
        const n = document.getElementById('pn').value;
        const p = document.getElementById('pp').value;
        const f = document.getElementById('pf').files[0];
        const r = new FileReader();
        r.onload = e => db.ref('products/'+c).push({ n, p: Number(p), img: e.target.result });
        r.readAsDataURL(f); alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±");
    }

    function openCat(id, name) {
        document.getElementById('viewCats').classList.add('hidden');
        document.getElementById('viewProds').classList.remove('hidden');
        document.getElementById('catTitle').innerText = name;
        db.ref('products/'+id).on('value', s => {
            const box = document.getElementById('prodsBox'); box.innerHTML = "";
            s.forEach(p => {
                const pd = p.val();
                const div = document.createElement('div');
                div.className = 'prod-box';
                div.innerHTML = `<img src="${pd.img}"><h4>${pd.n}</h4><b>${pd.p} Ø¬</b>`;
                div.onclick = () => openBuy(pd);
                box.appendChild(div);
            });
        });
    }

    function openBuy(p) {
        if(!user) return openAuth();
        selP = p; document.getElementById('buyModal').classList.add('active');
        document.getElementById('bt').innerText = p.n;
        document.getElementById('bp').innerText = p.p;
        document.getElementById('bq').value = 1; calc();
    }

    function calc() {
        const q = document.getElementById('bq').value;
        const tot = q * selP.p;
        document.getElementById('btot').innerText = tot;
        const btn = document.getElementById('bAct');
        if(user.balance >= tot) btn.innerHTML = `<button class="btn btn-green" onclick="buy(${tot},${q})">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø±Ø§Ø¡ âœ…</button>`;
        else btn.innerHTML = `<button class="btn" style="background:#333" disabled>Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ âš ï¸</button>`;
    }

    function buy(t, q) {
        db.ref('users/'+user.email).update({ balance: user.balance - t });
        db.ref('orders').push({ u: user.name, id: user.uid, p: selP.n, q: q, t: t, time: new Date().toLocaleString() });
        alert("ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!"); closeM('buyModal');
    }

    // --- Ø§Ù„Ø´Ø­Ù† ---
    function findU() {
        const id = document.getElementById('sid').value;
        db.ref('idMap/'+id).once('value', s => {
            if(!s.exists()) return alert("ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            tMail = s.val();
            db.ref('users/'+tMail).once('value', u => {
                document.getElementById('res').classList.remove('hidden');
                document.getElementById('rt').innerText = "Ø§Ù„ÙˆÙƒÙŠÙ„: " + u.val().name;
            });
        });
    }
    function charge() {
        const a = Number(document.getElementById('ra').value);
        db.ref('users/'+tMail).once('value', s => {
            db.ref('users/'+tMail).update({ balance: (s.val().balance||0)+a });
            alert("ØªÙ… Ø§Ù„Ø´Ø­Ù†!");
        });
    }

    // Ø³Ù„Ø§ÙŠØ¯Ø±
    db.ref('banners').on('value', s => {
        const box = document.getElementById('slideBox'); box.innerHTML = "";
        s.forEach(b => box.innerHTML += `<img src="${b.val()}">`);
    });
    setInterval(() => {
        const box = document.getElementById('slideBox');
        if(box.children.length > 1) {
            box.appendChild(box.firstElementChild);
        }
    }, 3000);

    loadCats();
</script>
</body>
</html>
