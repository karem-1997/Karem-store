<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - The Master System</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        :root {
            --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%);
            --bg: #050505;
            --card-bg: #0d0d0d;
            --input-bg: #161616;
            --text-gold: #fcf6ba;
            --shadow: 0 15px 35px rgba(0,0,0,0.8), 0 5px 15px rgba(191,149,63,0.1);
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg);
            color: #ffffff;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .master-title {
            font-size: 42px;
            font-weight: 900;
            background: var(--gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            margin: 10px 0;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© */
        .tabs-wrapper {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
            max-width: 600px;
        }

        .tab-btn {
            background: #1a1a1a;
            color: #aaa;
            border: 1px solid #333;
            padding: 12px 24px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 800;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab-btn.active {
            background: var(--gold);
            color: #000;
            border-color: transparent;
            box-shadow: 0 0 15px rgba(191,149,63,0.4);
            transform: scale(1.05);
        }

        /* ÙƒØ§Ø±Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .main-card {
            background: var(--card-bg);
            border: 1px solid rgba(191, 149, 63, 0.2);
            border-radius: 35px;
            padding: 35px;
            width: 100%;
            max-width: 460px;
            box-shadow: var(--shadow);
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø£ÙŠØ¯ÙŠ */
        .info-header { text-align: center; margin-bottom: 25px; }
        .warning-text { color: #ff4d4d; font-size: 12px; font-weight: 700; background: rgba(255,77,77,0.1); padding: 8px; border-radius: 10px; margin: 10px 0; }
        
        .copy-card {
            background: rgba(191,149,63,0.05);
            border: 1px dashed #bf953f;
            border-radius: 20px;
            padding: 15px;
            cursor: pointer;
            transition: 0.3s;
        }
        .copy-card:active { transform: scale(0.98); background: rgba(191,149,63,0.15); }

        /* Ø§Ù„Ø®Ø§Ù†Ø§Øª */
        .group { margin-bottom: 20px; width: 100%; }
        label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-gold); font-weight: bold; }
        input, select {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid rgba(191,149,63,0.2);
            border-radius: 15px;
            padding: 15px;
            color: #fff;
            font-size: 15px;
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }
        input:focus { border-color: #bf953f; box-shadow: 0 0 10px rgba(191,149,63,0.2); }

        /* ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø­Ø³Ø§Ø¨ */
        .result-box {
            background: linear-gradient(to bottom, rgba(191,149,63,0.1), transparent);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            margin: 20px 0;
            border: 1px solid rgba(191,149,63,0.1);
        }
        .total-val { font-size: 30px; font-weight: 900; color: #fff; margin-top: 5px; }

        .submit-btn {
            width: 100%;
            padding: 20px;
            background: var(--gold);
            border: none;
            border-radius: 18px;
            font-size: 20px;
            font-weight: 900;
            color: #000;
            cursor: pointer;
            transition: 0.3s;
        }
        .submit-btn:hover { filter: brightness(1.1); transform: translateY(-2px); }

        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminScreen {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
        }
        .admin-inner {
            background: #0a0a0a;
            border: 2px solid #bf953f;
            border-radius: 30px;
            max-width: 600px;
            margin: auto;
            padding: 30px;
        }
        .admin-section { background: #111; padding: 20px; border-radius: 20px; margin-bottom: 20px; border: 1px solid #222; }
        .agent-item { display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>

<h1 class="master-title" onclick="openAdmin()">Helmy Card</h1>

<div class="tabs-wrapper" id="navTabs"></div>

<div class="main-card" id="userForm">
    <div class="info-header">
        <h2 id="app_title" style="margin:0; color:gold;"></h2>
        <div id="app_warn" class="warning-text"></div>
        <div class="copy-card" onclick="copyValue()">
            <small style="color: #888;">ID Ø§Ù„Ø³Ø­Ø¨ (Ø§Ø¶ØºØ· Ù„Ù„Ù†Ø³Ø®)</small><br>
            <span id="app_aid" style="font-size: 20px; font-weight: 900;"></span><br>
            <small>Ø§Ù„Ù…Ø³ØªÙ„Ù…: <b id="app_aname"></b></small>
        </div>
    </div>

    <div class="group">
        <label id="label_uid">Ø§Ù„Ø£ÙŠØ¯ÙŠ</label>
        <input type="text" id="inp_uid" placeholder="Ø£Ø¯Ø®Ù„ ID Ø­Ø³Ø§Ø¨Ùƒ">
    </div>

    <div class="group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
        <select id="inp_method" onchange="updateView()">
            <option value="cash">ÙƒØ§Ø´ (ÙÙˆØ¯Ø§ÙÙˆÙ†/Ø§ØªØµØ§Ù„Ø§Øª/Ø£ÙˆØ±Ù†Ø¬)</option>
            <option value="agent_all">Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…</option>
            <option value="agent_vip">ÙˆÙƒÙŠÙ„ Ù…Ø³Ø¬Ù„ (ÙƒÙˆØ¯ Ø®Ø§Øµ) ğŸ”½</option>
        </select>
    </div>

    <div class="group" id="vipGroup" style="display: none;">
        <label>Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <select id="inp_vip_list" onchange="runCalc()"></select>
    </div>

    <div class="group" id="pointsGroup" style="display: none;">
        <label id="label_points">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·</label>
        <input type="number" id="inp_points" placeholder="0" oninput="runCalc()">
    </div>

    <div class="group">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)</label>
        <input type="number" id="inp_usd" placeholder="0.00" oninput="runCalc()">
    </div>

    <div class="result-box">
        <div style="font-size: 12px; color: gold; margin-bottom: 5px;" id="rate_info">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: 0</div>
        <div class="total-val" id="res_egp">0.00 Ø¬.Ù…</div>
    </div>

    <div class="group">
        <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù…Øª Ù…Ù†Ù‡)</label>
        <input type="text" id="inp_wallet" placeholder="01xxxxxxxxx">
    </div>

    <div class="group">
        <label>Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <input type="file" id="inp_file" accept="image/*">
    </div>

    <button class="submit-btn" onclick="sendMasterOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="adminScreen">
    <div class="admin-inner">
        <h2 style="text-align: center; color: gold;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h2>
        
        <div class="admin-section" style="border-color: #22c55e;">
            <label style="color: #22c55e;">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù†Ø¸Ø§Ù…</label>
            <input type="text" id="adm_new_name" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØªØ·Ø¨ÙŠÙ‚ Ù„ÙŠÙÙ„Ø²">
            <button onclick="addSystem()" style="width: 100%; margin-top: 10px; background: #22c55e; color: #000; font-weight: bold; border: none; padding: 12px; border-radius: 12px; cursor: pointer;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</button>
        </div>

        <div id="adm_edit_area" style="display: none;">
            <h3 style="color: gold; border-right: 4px solid gold; padding-right: 15px;">ØªØ¹Ø¯ÙŠÙ„: <span id="adm_target_name"></span></h3>
            
            <div class="admin-section">
                <label>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· (ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ùˆ Ø¥ÙƒØ³Ù„)</label>
                <input type="text" id="adm_sheet" placeholder="Ø±Ø§Ø¨Ø· Google Script">
                <input type="text" id="adm_token" placeholder="ØªÙˆÙƒÙ† Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…" style="margin-top: 5px;">
                <input type="text" id="adm_chatid" placeholder="Chat ID" style="margin-top: 5px;">
            </div>

            <div class="admin-section">
                <label>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</label>
                <input type="text" id="adm_l_uid" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ø£ÙŠØ¯ÙŠ">
                <input type="text" id="adm_warn" placeholder="Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ±" style="margin-top: 5px;">
                <input type="text" id="adm_aid" placeholder="ID Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" style="margin-top: 5px;">
                <input type="text" id="adm_aname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…" style="margin-top: 5px;">
            </div>

            <div class="admin-section">
                <label>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                <select id="adm_mode" onchange="toggleAdmPoints()">
                    <option value="usd">Ø¯ÙˆÙ„Ø§Ø± ÙÙ‚Ø·</option>
                    <option value="points">Ù†Ù‚Ø§Ø· + Ø¯ÙˆÙ„Ø§Ø±</option>
                </select>
                <div id="adm_pts_sub" style="margin-top: 10px; display: none;">
                    <input type="text" id="adm_l_pts" placeholder="Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø·">
                    <input type="number" id="adm_p_rate" placeholder="ÙƒÙ„ ÙƒÙ… Ù†Ù‚Ø·Ø© = 1 Ø¯ÙˆÙ„Ø§Ø±ØŸ" style="margin-top: 5px;">
                </div>
            </div>

            <div class="admin-section">
                <label>Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ù„Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„ÙˆØ§Ø­Ø¯)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="number" step="0.1" id="adm_rv" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø´">
                    <input type="number" step="0.1" id="adm_ra" placeholder="Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙŠÙ„">
                </div>
                
                <label style="margin-top: 15px; display: block;">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ø®ØµØµÙŠÙ†:</label>
                <div id="adm_agents_list"></div>
                <button onclick="addRow()" style="width: 100%; background: #333; color: #fff; border: none; padding: 10px; border-radius: 10px; cursor: pointer; margin-top: 10px;">+ Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
            </div>

            <button onclick="saveAll()" class="submit-btn">Ø­ÙØ¸ ÙƒÙ„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…</button>
            <button onclick="deleteSystem()" style="width: 100%; background: #441111; color: #ff4d4d; border: 1px solid #ff4d4d; margin-top: 15px; padding: 10px; border-radius: 12px; cursor: pointer;">Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ğŸ—‘ï¸</button>
        </div>

        <button onclick="document.getElementById('adminScreen').style.display='none'" style="width: 100%; background: #222; color: #fff; border: none; margin-top: 20px; padding: 15px; border-radius: 15px; cursor: pointer;">Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>
</div>

<script>
    // ØªÙ‡ÙŠØ¦Ø© ÙØ§ÙŠØ±Ø¨ÙŠØ² (Ù†ÙØ³ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ù‚Ø§Ø¹Ø¯Ø©)
    const firebaseConfig = {
        apiKey: "AIzaSyDp1PmSbyiyP-cEZyPy9sK3FnKKKhbnJKQ",
        authDomain: "karak-13101.firebaseapp.com",
        projectId: "karak-13101",
        databaseURL: "https://karak-13101-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let systems = {};
    let activeID = "";

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ…Ø²Ø§Ù…Ù†ØªÙ‡Ø§ Ù„Ø­Ø¸ÙŠØ§Ù‹
    db.ref('Helmy_Master_System').on('value', (snap) => {
        systems = snap.val() || { "ÙƒØ±Ùƒ": { rv:45, ra:46, aid:"800050", aname:"Helmy Fire", warn:"Ø§Ù„Ø¯ÙØ¹ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©", l_uid:"ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ", mode:"usd", agents:{} } };
        drawTabs();
        if(!activeID) selectSystem("ÙƒØ±Ùƒ");
        else selectSystem(activeID);
    });

    function drawTabs() {
        const container = document.getElementById('navTabs');
        container.innerHTML = '';
        for (let name in systems) {
            const btn = document.createElement('button');
            btn.className = `tab-btn ${activeID === name ? 'active' : ''}`;
            btn.innerText = name;
            btn.onclick = () => selectSystem(name);
            container.appendChild(btn);
        }
    }

    function selectSystem(name) {
        activeID = name;
        const data = systems[name];
        document.getElementById('userForm').style.display = 'block';
        document.getElementById('app_title').innerText = name;
        document.getElementById('app_warn').innerText = data.warn || "";
        document.getElementById('app_aid').innerText = data.aid || "";
        document.getElementById('app_aname').innerText = data.aname || "";
        document.getElementById('label_uid').innerText = data.l_uid || "Ø§Ù„Ø£ÙŠØ¯ÙŠ";

        if(data.mode === 'points') {
            document.getElementById('pointsGroup').style.display = 'block';
            document.getElementById('label_points').innerText = data.l_pts || "Ø§Ù„Ù†Ù‚Ø§Ø·";
            document.getElementById('inp_usd').readOnly = true;
            document.getElementById('inp_usd').style.opacity = "0.6";
        } else {
            document.getElementById('pointsGroup').style.display = 'none';
            document.getElementById('inp_usd').readOnly = false;
            document.getElementById('inp_usd').style.opacity = "1";
        }

        const vSelect = document.getElementById('inp_vip_list');
        vSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ --</option>';
        if(data.agents) {
            for(let code in data.agents) {
                let opt = document.createElement('option');
                opt.value = code; opt.text = code;
                vSelect.add(opt);
            }
        }
        drawTabs();
        runCalc();
    }

    function runCalc() {
        if(!activeID) return;
        const d = systems[activeID];
        if(d.mode === 'points') {
            const pts = parseFloat(document.getElementById('inp_points').value) || 0;
            const factor = parseFloat(d.p_rate) || 1;
            document.getElementById('inp_usd').value = (pts / factor).toFixed(2);
        }

        const usd = parseFloat(document.getElementById('inp_usd').value) || 0;
        const method = document.getElementById('inp_method').value;
        let rate = d.rv;

        if(method === 'agent_all') rate = d.ra;
        else if(method === 'agent_vip') {
            const c = document.getElementById('inp_vip_list').value;
            rate = (d.agents && d.agents[c]) ? d.agents[c] : d.ra;
        }

        document.getElementById('rate_info').innerText = "Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ù…Ø·Ø¨Ù‚: " + rate;
        document.getElementById('res_egp').innerText = (usd * rate).toFixed(2) + " Ø¬.Ù…";
        return { totalEGP: (usd * rate).toFixed(2), currentRate: rate };
    }

    function updateView() {
        document.getElementById('vipGroup').style.display = (document.getElementById('inp_method').value === 'agent_vip') ? 'block' : 'none';
        runCalc();
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function openAdmin() {
        if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©:") !== "1997") return;
        document.getElementById('adminScreen').style.display = 'block';
        if(activeID) {
            const d = systems[activeID];
            document.getElementById('adm_target_name').innerText = activeID;
            document.getElementById('adm_sheet').value = d.sheet || "";
            document.getElementById('adm_token').value = d.token || "";
            document.getElementById('adm_chatid').value = d.chatid || "";
            document.getElementById('adm_l_uid').value = d.l_uid || "";
            document.getElementById('adm_warn').value = d.warn || "";
            document.getElementById('adm_aid').value = d.aid || "";
            document.getElementById('adm_aname').value = d.aname || "";
            document.getElementById('adm_mode').value = d.mode || "usd";
            document.getElementById('adm_l_pts').value = d.l_pts || "";
            document.getElementById('adm_p_rate').value = d.p_rate || "";
            document.getElementById('adm_rv').value = d.rv || 45;
            document.getElementById('adm_ra').value = d.ra || 46;
            
            toggleAdmPoints();
            const list = document.getElementById('adm_agents_list');
            list.innerHTML = '';
            if(d.agents) { for(let c in d.agents) addRow(c, d.agents[c]); }
            document.getElementById('adm_edit_area').style.display = 'block';
        }
    }

    function addRow(c="", p="") {
        const div = document.createElement('div');
        div.className = 'agent-item';
        div.innerHTML = `<input type="text" class="c-code" value="${c}" placeholder="Ø§Ù„ÙƒÙˆØ¯"><input type="number" step="0.1" class="c-price" value="${p}" placeholder="Ø§Ù„Ø³Ø¹Ø±"><button onclick="this.parentElement.remove()" style="background:red; color:white; border:none; border-radius:8px; padding:5px 10px;">X</button>`;
        document.getElementById('adm_agents_list').appendChild(div);
    }

    function toggleAdmPoints() {
        document.getElementById('adm_pts_sub').style.display = (document.getElementById('adm_mode').value === 'points') ? 'block' : 'none';
    }

    function addSystem() {
        const n = document.getElementById('adm_new_name').value.trim();
        if(!n) return;
        db.ref('Helmy_Master_System/' + n).set({ rv:45, ra:46, aid:"000", aname:"Admin", mode:"usd" });
        document.getElementById('adm_new_name').value = "";
    }

    function saveAll() {
        const ags = {};
        document.querySelectorAll('.agent-item').forEach(i => {
            const c = i.querySelector('.c-code').value, p = i.querySelector('.c-price').value;
            if(c && p) ags[c] = parseFloat(p);
        });

        const obj = {
            sheet: document.getElementById('adm_sheet').value,
            token: document.getElementById('adm_token').value,
            chatid: document.getElementById('adm_chatid').value,
            l_uid: document.getElementById('adm_l_uid').value,
            warn: document.getElementById('adm_warn').value,
            aid: document.getElementById('adm_aid').value,
            aname: document.getElementById('adm_aname').value,
            mode: document.getElementById('adm_mode').value,
            l_pts: document.getElementById('adm_l_pts').value,
            p_rate: document.getElementById('adm_p_rate').value,
            rv: parseFloat(document.getElementById('adm_rv').value),
            ra: parseFloat(document.getElementById('adm_ra').value),
            agents: ags
        };
        db.ref('Helmy_Master_System/' + activeID).update(obj).then(() => alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…"));
    }

    function deleteSystem() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            db.ref('Helmy_Master_System/' + activeID).remove();
            activeID = "";
            document.getElementById('adminScreen').style.display = 'none';
            document.getElementById('userForm').style.display = 'none';
        }
    }

    function copyValue() {
        navigator.clipboard.writeText(systems[activeID].aid);
        alert("ØªÙ… Ù†Ø³Ø® ID Ø§Ù„Ø³Ø­Ø¨!");
    }

    async function sendMasterOrder() {
        const file = document.getElementById('inp_file').files[0];
        const uid = document.getElementById('inp_uid').value;
        const config = systems[activeID];

        if(!file || !uid || !config.token) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø§Ù„Ø£ÙŠØ¯ÙŠØŒ ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª)");

        const { totalEGP, currentRate } = runCalc();
        const date = new Date().toLocaleString('ar-EG');
        let ptsTxt = config.mode === 'points' ? `ğŸ”¢ Ø§Ù„Ù†Ù‚Ø§Ø·: ${document.getElementById('inp_points').value}\n` : '';
        
        const msg = `ğŸ“¦ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯ (${activeID})\n` +
                    `â”â”â”â”â”â”â”â”â”â”â”â”\n` +
                    `ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${uid}\n` +
                    `${ptsTxt}` +
                    `ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº: ${document.getElementById('inp_usd').value}$\n` +
                    `ğŸ’¹ Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: ${currentRate}\n` +
                    `ğŸ‡ªğŸ‡¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalEGP} Ø¬.Ù…\n` +
                    `ğŸ’³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: ${document.getElementById('inp_method').value}\n` +
                    `ğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${document.getElementById('inp_wallet').value}\n` +
                    `â”â”â”â”â”â”â”â”â”â”â”â”\n` +
                    `â° Ø§Ù„ÙˆÙ‚Øª: ${date}`;

        try {
            const fd = new FormData();
            fd.append('chat_id', config.chatid);
            fd.append('photo', file);
            fd.append('caption', msg);
            await fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, { method: 'POST', body: fd });

            // Ù‡Ù†Ø§ Ù†ØªØ±Ùƒ Ø§Ù„Ù…ÙƒØ§Ù† Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ù„Ù„Ø±Ø¨Ø· Ø¨Ù€ Google Sheet ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            if(config.sheet) {
                // Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¨Ø±Ù…Ø¬Ø© Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙŠØª
                console.log("Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ Sheet Ù…ÙØ¹Ù„");
            }

            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
            location.reload();
        } catch(e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†"); }
    }
</script>

</body>
</html>
