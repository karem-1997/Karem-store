<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAREM STORE | FIXED</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --main: #ff0000; --bg: #000000; --card: #111111; --text: #ffffff; --gray: #222; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        header { background: #000; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gray); position: sticky; top: 0; z-index: 1000; }
        .logo { font-weight: 900; font-size: 1.5rem; color: var(--main); }
        .bal-box { background: rgba(0,255,0,0.1); color: #00ff00; padding: 4px 10px; border-radius: 10px; border: 1px solid #00ff00; font-size: 0.8rem; }
        .slider { width: 95%; height: 160px; margin: 10px auto; border-radius: 15px; overflow: hidden; position: relative; border: 1px solid var(--gray); }
        .slides { display: flex; transition: 0.5s; height: 100%; }
        .slides img { min-width: 100%; object-fit: cover; }
        .section-header { padding: 15px; font-weight: bold; color: var(--main); font-size: 1.2rem; border-right: 4px solid var(--main); margin: 10px 15px; background: #0a0a0a; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 15px; min-height: 50px; }
        .item-card { background: var(--card); border-radius: 12px; border: 1px solid var(--gray); padding: 8px; text-align: center; position: relative; }
        .item-card img { width: 100%; border-radius: 8px; aspect-ratio: 1/1; object-fit: cover; }
        .item-card h4 { font-size: 0.75rem; margin: 8px 0; height: 35px; overflow: hidden; color: #eee; }
        .item-card b { color: #00ff00; font-size: 0.9rem; }
        .del-btn { position: absolute; top: 5px; right: 5px; background: red; color: white; border: none; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; z-index: 10; font-weight: bold; }
        .admin-panel { background: #0a0000; border: 1px solid var(--main); margin: 15px; padding: 15px; border-radius: 15px; }
        input, select { width: 100%; padding: 12px; margin: 5px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-main { background: var(--main); color: #fff; }
        .side-menu { position: fixed; top: 0; right: -100%; width: 80%; height: 100%; background: #050505; z-index: 3000; transition: 0.3s; padding: 20px; border-left: 1px solid var(--gray); }
        .side-menu.active { right: 0; }
        .hidden { display: none !important; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; z-index: 2500; }
    </style>
</head>
<body>

<header>
    <div class="logo">KAREM STORE</div>
    <div id="topUser" class="hidden">
        <div class="bal-box"><span id="uBal">0</span> Ø¬ | ID: <span id="uID">--</span></div>
    </div>
    <i class="fa-solid fa-bars" onclick="toggleMenu()" style="font-size: 1.5rem; cursor: pointer;"></i>
</header>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="slider">
    <div class="slides" id="sliderContainer">
        <img src="https://img.freepik.com/premium-photo/gaming-banner-design_1143431-13.jpg">
    </div>
</div>

<div id="adminArea" class="hidden">
    <div class="admin-panel">
        <h3 style="color:var(--main); margin:0;">ğŸ› ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ÙƒØ±ÙŠÙ… (Ø§Ù„Ù…Ø¯ÙŠØ±)</h3>
        <div style="background: #111; padding: 10px; border-radius: 10px; margin-top:10px;">
            <h4>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h4>
            <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <select id="pCat">
                <option value="games">Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</option>
                <option value="apps">Ù‚Ø³Ù… Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</option>
                <option value="social">Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§</option>
            </select>
            <input type="file" id="pFile" accept="image/*">
            <button class="btn btn-main" onclick="uploadProduct()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¢Ù†</button>
        </div>
        <div style="background: #111; padding: 10px; border-radius: 10px; margin-top:10px;">
            <h4>ğŸ’° Ø´Ø­Ù† Ø±ØµÙŠØ¯ ÙˆÙƒÙŠÙ„</h4>
            <input type="number" id="targetID" placeholder="Ø§Ø¯Ø®Ù„ ID Ø§Ù„ÙˆÙƒÙŠÙ„">
            <button class="btn" style="background:#444; color:white" onclick="searchAgent()">Ø¨Ø­Ø«</button>
            <div id="agentResult" class="hidden">
                <p id="agentInfo"></p>
                <input type="number" id="addAmt" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <button class="btn" style="background:#00ff00; color:#000" onclick="confirmAddMoney()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</button>
            </div>
        </div>
    </div>
</div>

<div id="storeBody">
    <div class="section-header">ğŸ® Ù‚Ø³Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>
    <div class="grid" id="gamesGrid"></div>
    <div class="section-header">ğŸ“± Ù‚Ø³Ù… Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬</div>
    <div class="grid" id="appsGrid"></div>
    <div class="section-header">ğŸŒ Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§</div>
    <div class="grid" id="socialGrid"></div>
</div>

<div class="side-menu" id="sideMenu">
    <div id="guestMode">
        <button class="btn btn-main" onclick="openAuth()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </div>
    <div id="userMode" class="hidden">
        <h3 id="menuName"></h3>
        <p id="menuID" style="color:var(--main)"></p>
        <button class="btn" style="background:#00ff00; color:#000" onclick="alert('ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ø´Ø­Ù†')">Ø´Ø­Ù† Ø±ØµÙŠØ¯</button>
        <button class="btn" style="background:#333; color:white; margin-top:50px;" onclick="location.reload()">Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="authModal" class="hidden" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#111; padding:20px; border-radius:15px; width:90%; z-index:4000; border:1px solid #333;">
    <h3 id="authTitle">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ØµØ©</h3>
    <input type="text" id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… (Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙ‚Ø·)">
    <input type="email" id="regEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input type="password" id="regPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn btn-main" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„</button>
    <button class="btn" style="background:transparent; color:white" onclick="document.getElementById('authModal').classList.add('hidden')">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAalmOWMUhvCi_PuFSUbXRpbe1hmGyer7s",
        authDomain: "karem-store.firebaseapp.com",
        databaseURL: "https://karem-store-default-rtdb.firebaseio.com",
        projectId: "karem-store",
        storageBucket: "karem-store.firebasestorage.app",
        messagingSenderId: "898294902448",
        appId: "1:898294902448:web:23cbee5afd72adcb67d575",
        measurementId: "G-V56WJVTN4J"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let userRole = 'guest';
    let userEmail = '';
    let foundEmail = '';

    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); document.getElementById('overlay').style.display = document.getElementById('sideMenu').classList.contains('active') ? 'block' : 'none'; }
    function openAuth() { document.getElementById('authModal').classList.remove('hidden'); toggleMenu(); }

    function handleAuth() {
        const email = document.getElementById('regEmail').value.replace(/\./g, '_').toLowerCase();
        const pass = document.getElementById('regPass').value;
        const name = document.getElementById('regName').value;

        if(email === 'admin@karem_com' && pass === '123456') {
            const adminData = { name: 'ÙƒØ±ÙŠÙ… (Ø§Ù„Ù…Ø¯ÙŠØ±)', email, uid: 1001, role: 'admin', balance: 999999, pass: '123456' };
            db.ref('users/'+email).update(adminData);
            db.ref('idMap/1001').set(email);
            login(adminData);
            return;
        }

        db.ref('users/' + email).once('value', snap => {
            if(snap.exists()) {
                if(snap.val().pass === pass) login(snap.val());
                else alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø®Ø·Ø£");
            } else {
                db.ref('lastID').transaction(c => {
                    const next = (c || 1000) + 1;
                    const u = { name, email, pass, balance:0, uid:next, role:'user' };
                    db.ref('users/'+email).set(u);
                    db.ref('idMap/'+next).set(email);
                    login(u); return next;
                });
            }
        });
    }

    function login(d) {
        userRole = d.role;
        userEmail = d.email;
        document.getElementById('authModal').classList.add('hidden');
        document.getElementById('topUser').classList.remove('hidden');
        document.getElementById('guestMode').classList.add('hidden');
        document.getElementById('userMode').classList.remove('hidden');
        document.getElementById('menuName').innerText = d.name;
        document.getElementById('menuID').innerText = "ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„: " + d.uid;
        document.getElementById('uID').innerText = d.uid;
        
        db.ref('users/'+d.email+'/balance').on('value', s => document.getElementById('uBal').innerText = s.val() || 0);
        if(d.role === 'admin') document.getElementById('adminArea').classList.remove('hidden');
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø´Ø§Ù† Ø§Ù„Ù€ Del Button ÙŠØ¸Ù‡Ø± Ù„Ù„Ø£Ø¯Ù…Ù†
        renderStore();
    }

    function uploadProduct() {
        const n = document.getElementById('pName').value;
        const p = document.getElementById('pPrice').value;
        const c = document.getElementById('pCat').value;
        const file = document.getElementById('pFile').files[0];
        if(!n || !p || !file) return alert("Ø§ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬");

        const reader = new FileReader();
        reader.onload = e => {
            db.ref('products/' + c).push({ n, p, img: e.target.result }).then(() => {
                alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬!");
                document.getElementById('pName').value = "";
                document.getElementById('pPrice').value = "";
            });
        };
        reader.readAsDataURL(file);
    }

    function renderStore() {
        const cats = ['games', 'apps', 'social'];
        cats.forEach(cat => {
            db.ref('products/' + cat).on('value', snap => {
                const grid = document.getElementById(cat + 'Grid');
                grid.innerHTML = "";
                if(snap.exists()){
                    snap.forEach(s => {
                        const p = s.val();
                        grid.innerHTML += `
                            <div class="item-card">
                                ${userRole === 'admin' ? `<button class="del-btn" onclick="deleteP('${cat}','${s.key}')">X</button>` : ''}
                                <img src="${p.img}">
                                <h4>${p.n}</h4>
                                <b>${p.p} Ø¬</b>
                            </div>`;
                    });
                } else {
                    grid.innerHTML = "<p style='color:#555; font-size:0.8rem;'>Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p>";
                }
            });
        });
    }

    function deleteP(c, k) { if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) db.ref('products/'+c+'/'+k).remove(); }

    function searchAgent() {
        const id = document.getElementById('targetID').value;
        db.ref('idMap/'+id).once('value', snap => {
            if(!snap.exists()) return alert("ID ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
            foundEmail = snap.val();
            db.ref('users/'+foundEmail).once('value', s => {
                document.getElementById('agentResult').classList.remove('hidden');
                document.getElementById('agentInfo').innerText = "Ø§Ù„ÙˆÙƒÙŠÙ„: " + s.val().name + " | Ø±ØµÙŠØ¯: " + s.val().balance;
            });
        });
    }

    function confirmAddMoney() {
        const amt = Number(document.getElementById('addAmt').value);
        db.ref('users/'+foundEmail).once('value', s => {
            db.ref('users/'+foundEmail).update({ balance: (s.val().balance || 0) + amt });
            alert("ØªÙ… Ø§Ù„Ø´Ø­Ù†!");
            document.getElementById('agentResult').classList.add('hidden');
        });
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ø¬Ù…ÙŠØ¹ Ø­ØªÙ‰ Ù„Ùˆ Ø²Ø§Ø¦Ø±
    renderStore();

    // Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø¨Ù†Ø±Ø§Øª
    db.ref('banners').on('value', snap => {
        const cont = document.getElementById('sliderContainer');
        if(snap.exists()) {
            cont.innerHTML = "";
            snap.forEach(s => cont.innerHTML += `<img src="${s.val()}">`);
        }
    });
</script>
</body>
</html>
