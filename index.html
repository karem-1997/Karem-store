<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        :root { --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%); --bg: #050505; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg); color: #fff; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        .header-title { font-size: 35px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; margin: 15px 0; }
        .tabs-container { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .tab-btn { background: #1a1a1a; color: #888; border: 1px solid #333; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: var(--gold); color: #000; border-color: transparent; }

        .form-card { background: #0d0d0d; border: 1px solid rgba(191,149,63,0.3); border-radius: 25px; padding: 25px; width: 100%; max-width: 450px; display: none; box-shadow: 0 20px 40px rgba(0,0,0,0.8); }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #adminPanel { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; padding: 15px; overflow-y: auto; }
        .admin-box { background: #0a0a0a; border: 2px solid #bf953f; border-radius: 25px; max-width: 600px; margin: auto; padding: 25px; }
        .admin-section { background: #151515; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #222; }
        
        .input-group { margin-bottom: 12px; text-align: right; }
        label { display: block; margin-bottom: 5px; font-size: 13px; color: #fcf6ba; font-weight: bold; }
        input, select, textarea { width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 10px; padding: 12px; color: #fff; box-sizing: border-box; outline: none; }
        input:focus { border-color: #bf953f; }

        .price-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .agent-item { display: grid; grid-template-columns: 1.5fr 1fr auto; gap: 8px; margin-bottom: 8px; }
        .btn-add { background: #22c55e; color: #000; font-weight: bold; border: none; padding: 10px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 5px; }
        .btn-del { background: #ef4444; color: #fff; border: none; border-radius: 8px; padding: 5px 10px; cursor: pointer; }
        .btn-save { background: var(--gold); color: #000; font-weight: 900; border: none; padding: 15px; border-radius: 12px; cursor: pointer; width: 100%; font-size: 18px; }
        
        .res-box { background: rgba(191,149,63,0.1); padding: 15px; border-radius: 15px; text-align: center; margin: 15px 0; border: 1px solid rgba(191,149,63,0.2); }
        .copy-box { background: #151515; border: 1px dashed #bf953f; padding: 12px; border-radius: 15px; cursor: pointer; text-align: center; margin-bottom: 15px; }
    </style>
</head>
<body>

<h1 class="header-title" onclick="openAdmin()">Helmy Card</h1>

<div class="tabs-container" id="navTabs"></div>

<div class="form-card" id="mainForm">
    <div style="text-align:center;">
        <h2 id="u_app_name" style="color:gold; margin:0;"></h2>
        <p id="u_app_warn" style="color:#ff4d4d; font-size:12px; font-weight:bold;"></p>
        <div class="copy-box" onclick="copyID()">
            ID Ø§Ù„Ø³Ø­Ø¨: <b id="u_app_aid"></b><br>
            Ø§Ù„Ù…Ø³ØªÙ„Ù…: <b id="u_app_aname"></b>
        </div>
    </div>

    <div class="input-group">
        <label id="l_u_id">Ø§Ù„Ø£ÙŠØ¯ÙŠ</label>
        <input type="text" id="i_u_id" placeholder="Ø£Ø¯Ø®Ù„ ID Ø­Ø³Ø§Ø¨Ùƒ">
    </div>

    <div class="input-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</label>
        <select id="i_method" onchange="toggleAgentView(); calc();">
            <option value="cash">ÙƒØ§Ø´ (ÙÙˆØ¯Ø§ÙÙˆÙ†/Ø§ØªØµØ§Ù„Ø§Øª/Ø£ÙˆØ±Ù†Ø¬)</option>
            <option value="agent_gen">Ø³Ø­Ø¨ ÙˆÙƒÙ„Ø§Ø¡ (Ø³Ø¹Ø± Ù…ÙˆØ­Ø¯)</option>
            <option value="agent_vip">ÙƒÙˆØ¯ ÙˆÙƒÙŠÙ„ Ù…Ø³Ø¬Ù„ (Ø³Ø¹Ø± Ø®Ø§Øµ) ğŸ”½</option>
        </select>
    </div>

    <div class="input-group" id="vip_area" style="display:none;">
        <label>Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„</label>
        <select id="i_vip_list" onchange="calc()"></select>
    </div>

    <div class="input-group" id="points_area" style="display:none;">
        <label id="l_u_pts">Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·</label>
        <input type="number" id="i_pts" placeholder="0" oninput="calc()">
    </div>

    <div class="input-group">
        <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± ($)</label>
        <input type="number" id="i_usd" placeholder="0.00" oninput="calc()">
    </div>

    <div class="res-box">
        <div id="rate_info" style="font-size:11px; color:gold;">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù: 0</div>
        <div style="font-size:24px; font-weight:900;" id="res_egp">0.00 Ø¬.Ù…</div>
    </div>

    <div class="input-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</label><input type="text" id="i_wallet" placeholder="01xxxxxxxxx"></div>
    <div class="input-group"><label>Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</label><input type="file" id="i_file" accept="image/*"></div>

    <button class="btn-save" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸš€</button>
</div>

<div id="adminPanel">
    <div class="admin-box">
        <h2 style="text-align:center; color:gold;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>
        
        <div class="admin-section" style="border-color:#22c55e;">
            <label>Ø¥Ø¶Ø§ÙØ© Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø¯ÙŠØ¯</label>
            <input type="text" id="a_new_app" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
            <button class="btn-add" onclick="createApp()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
        </div>

        <div id="editArea" style="display:none;">
            <h3 style="color:gold;">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ø¬: <span id="a_target"></span></h3>
            
            <div class="admin-section">
                <label>Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· (API)</label>
                <div class="input-group"><label>ØªÙˆÙƒÙ† Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…</label><input type="text" id="a_token"></div>
                <div class="input-group"><label>Chat ID</label><input type="text" id="a_chatid"></div>
                <div class="input-group"><label>Ø±Ø§Ø¨Ø· Google Script (Ø§Ù„Ø¥ÙƒØ³Ù„)</label><input type="text" id="a_sheet"></div>
            </div>

            <div class="admin-section">
                <label>Ù†ØµÙˆØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø§Ù„Ø£Ø³Ù…Ø§Ø¡)</label>
                <div class="input-group"><label>Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù€ ID (Ù…Ø«Ù„: Ø£ÙŠØ¯ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨)</label><input type="text" id="a_l_uid"></div>
                <div class="input-group"><label>Ù†Øµ Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„Ø¹Ù„ÙˆÙŠ</label><input type="text" id="a_warn"></div>
                <div class="input-group"><label>ID Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</label><input type="text" id="a_aid"></div>
                <div class="input-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label><input type="text" id="a_aname"></div>
            </div>

            <div class="admin-section">
                <label>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø¹Ù…Ù„</label>
                <select id="a_mode" onchange="toggleAdmPts()">
                    <option value="usd">Ø¯ÙˆÙ„Ø§Ø± Ù…Ø¨Ø§Ø´Ø±</option>
                    <option value="pts">Ù†Ù‚Ø§Ø· ØªØªØ­ÙˆÙ„ Ù„Ø¯ÙˆÙ„Ø§Ø±</option>
                </select>
                <div id="pts_conf" style="display:none; margin-top:10px;">
                    <div class="input-group"><label>Ø§Ø³Ù… Ø®Ø§Ù†Ø© Ø§Ù„Ù†Ù‚Ø§Ø· (Ù…Ø«Ù„: Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆØ§Ù‡Ø±)</label><input type="text" id="a_l_pts"></div>
                    <div class="input-group"><label>ÙƒÙ„ ÙƒÙ… Ù†Ù‚Ø·Ø© = 1 Ø¯ÙˆÙ„Ø§Ø±ØŸ</label><input type="number" id="a_p_rate"></div>
                </div>
            </div>

            <div class="admin-section">
                <label>ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</label>
                <div class="price-row">
                    <div class="input-group"><label>Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ø´</label><input type="number" step="0.1" id="a_rv"></div>
                    <div class="input-group"><label>Ø³Ø¹Ø± Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</label><input type="number" step="0.1" id="a_ra"></div>
                </div>
                
                <label style="margin-top:10px; display:block;">Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ (VIP)</label>
                <div id="a_agents_list"></div>
                <button class="btn-add" style="background:#444; color:#fff;" onclick="addAgentRow()">+ Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ Ù…Ø®ØµØµ</button>
            </div>

            <button class="btn-save" onclick="saveData()">Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…</button>
            <button onclick="delApp()" style="width:100%; background:#441111; color:red; border:1px solid red; margin-top:10px; padding:10px; border-radius:10px; cursor:pointer;">Ø­Ø°Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ğŸ—‘ï¸</button>
        </div>
        <button onclick="document.getElementById('adminPanel').style.display='none'" style="width:100%; background:#222; color:#fff; border:none; margin-top:15px; padding:12px; border-radius:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDp1PmSbyiyP-cEZyPy9sK3FnKKKhbnJKQ",
        authDomain: "karak-13101.firebaseapp.com",
        projectId: "karak-13101",
        databaseURL: "https://karak-13101-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let apps = {}; let active = "";

    // Sync Data
    db.ref('Helmy_Final_v6').on('value', (snap) => {
        apps = snap.val() || { "ÙƒØ±Ùƒ": { rv:45, ra:46, aid:"800050", aname:"Helmy Fire", mode:"usd", l_uid:"ğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ" } };
        renderTabs();
        if(!active) select("ÙƒØ±Ùƒ"); else select(active);
    });

    function renderTabs() {
        const nav = document.getElementById('navTabs'); nav.innerHTML = '';
        for (let name in apps) {
            const b = document.createElement('button');
            b.className = `tab-btn ${active === name ? 'active' : ''}`;
            b.innerText = name; b.onclick = () => select(name);
            nav.appendChild(b);
        }
    }

    function select(name) {
        active = name; const d = apps[name];
        document.getElementById('mainForm').style.display = 'block';
        document.getElementById('u_app_name').innerText = name;
        document.getElementById('u_app_warn').innerText = d.warn || "";
        document.getElementById('u_app_aid').innerText = d.aid || "";
        document.getElementById('u_app_aname').innerText = d.aname || "";
        document.getElementById('l_u_id').innerText = d.l_uid || "Ø§Ù„Ø£ÙŠØ¯ÙŠ";

        if(d.mode === 'pts') {
            document.getElementById('points_area').style.display = 'block';
            document.getElementById('l_u_pts').innerText = d.l_pts || "Ø§Ù„Ù†Ù‚Ø§Ø·";
            document.getElementById('i_usd').readOnly = true;
        } else {
            document.getElementById('points_area').style.display = 'none';
            document.getElementById('i_usd').readOnly = false;
        }

        const vList = document.getElementById('i_vip_list');
        vList.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ¯ --</option>';
        if(d.agents) { for(let c in d.agents) { let o = document.createElement('option'); o.value=c; o.text=c; vList.add(o); } }
        renderTabs(); calc();
    }

    function calc() {
        if(!active) return; const d = apps[active];
        if(d.mode === 'pts') {
            const p = parseFloat(document.getElementById('i_pts').value) || 0;
            const r = parseFloat(d.p_rate) || 1;
            document.getElementById('i_usd').value = (p / r).toFixed(2);
        }
        const usd = parseFloat(document.getElementById('i_usd').value) || 0;
        const m = document.getElementById('i_method').value;
        let rate = d.rv;
        if(m === 'agent_gen') rate = d.ra;
        else if(m === 'agent_vip') { const c = document.getElementById('i_vip_list').value; rate = (d.agents && d.agents[c]) ? d.agents[c] : d.ra; }
        document.getElementById('rate_info').innerText = "Ø§Ù„Ø³Ø¹Ø±: " + rate;
        document.getElementById('res_egp').innerText = (usd * rate).toFixed(2) + " Ø¬.Ù…";
        return { total: (usd * rate).toFixed(2), rate };
    }

    function toggleAgentView() { document.getElementById('vip_area').style.display = (document.getElementById('i_method').value === 'agent_vip') ? 'block' : 'none'; }
    function toggleAdmPts() { document.getElementById('pts_conf').style.display = (document.getElementById('a_mode').value === 'pts') ? 'block' : 'none'; }

    function openAdmin() {
        if(prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:") !== "1997") return;
        document.getElementById('adminPanel').style.display = 'block';
        if(active) {
            const d = apps[active];
            document.getElementById('a_target').innerText = active;
            document.getElementById('a_token').value = d.token || "";
            document.getElementById('a_chatid').value = d.chatid || "";
            document.getElementById('a_sheet').value = d.sheet || "";
            document.getElementById('a_l_uid').value = d.l_uid || "";
            document.getElementById('a_warn').value = d.warn || "";
            document.getElementById('a_aid').value = d.aid || "";
            document.getElementById('a_aname').value = d.aname || "";
            document.getElementById('a_mode').value = d.mode || "usd";
            document.getElementById('a_l_pts').value = d.l_pts || "";
            document.getElementById('a_p_rate').value = d.p_rate || "";
            document.getElementById('a_rv').value = d.rv || 45;
            document.getElementById('a_ra').value = d.ra || 46;
            toggleAdmPts();
            const list = document.getElementById('a_agents_list'); list.innerHTML = '';
            if(d.agents) { for(let c in d.agents) addAgentRow(c, d.agents[c]); }
            document.getElementById('editArea').style.display = 'block';
        }
    }

    function addAgentRow(c="", p="") {
        const div = document.createElement('div'); div.className = 'agent-item';
        div.innerHTML = `<input type="text" class="v-c" value="${c}" placeholder="Ø§Ù„ÙƒÙˆØ¯"><input type="number" step="0.1" class="v-p" value="${p}" placeholder="Ø§Ù„Ø³Ø¹Ø±"><button class="btn-del" onclick="this.parentElement.remove()">X</button>`;
        document.getElementById('a_agents_list').appendChild(div);
    }

    function createApp() {
        const n = document.getElementById('a_new_app').value; if(!n) return;
        db.ref('Helmy_Final_v6/' + n).set({ rv:45, ra:46, mode:"usd", l_uid:"Ø§Ù„Ø£ÙŠØ¯ÙŠ" });
    }

    function saveData() {
        const ags = {}; document.querySelectorAll('.agent-item').forEach(i => {
            const c = i.querySelector('.v-c').value, p = i.querySelector('.v-p').value;
            if(c && p) ags[c] = parseFloat(p);
        });
        const up = {
            token: document.getElementById('a_token').value,
            chatid: document.getElementById('a_chatid').value,
            sheet: document.getElementById('a_sheet').value,
            l_uid: document.getElementById('a_l_uid').value,
            warn: document.getElementById('a_warn').value,
            aid: document.getElementById('a_aid').value,
            aname: document.getElementById('a_aname').value,
            mode: document.getElementById('a_mode').value,
            l_pts: document.getElementById('a_l_pts').value,
            p_rate: document.getElementById('a_p_rate').value,
            rv: parseFloat(document.getElementById('a_rv').value),
            ra: parseFloat(document.getElementById('a_ra').value),
            agents: ags
        };
        db.ref('Helmy_Final_v6/' + active).update(up).then(() => alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…"));
    }

    function delApp() { if(confirm("Ø­Ø°ÙØŸ")) db.ref('Helmy_Final_v6/' + active).remove(); }
    function copyID() { navigator.clipboard.writeText(apps[active].aid); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!"); }

    async function sendOrder() {
        const f = document.getElementById('i_file').files[0];
        const u = document.getElementById('i_u_id').value;
        const c = apps[active];
        if(!f || !u || !c.token) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
        const { total, rate } = calc();
        const d = new Date().toLocaleString('ar-EG');
        let pts = c.mode === 'pts' ? `ğŸ”¢ Ø§Ù„Ù†Ù‚Ø§Ø·: ${document.getElementById('i_pts').value}\n` : '';
        const msg = `ğŸ“¦ Ø·Ù„Ø¨: ${active}\nğŸ†” Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${u}\n${pts}ğŸ’µ Ø¯ÙˆÙ„Ø§Ø±: ${document.getElementById('i_usd').value}$\nğŸ’¹ Ø§Ù„Ø³Ø¹Ø±: ${rate}\nğŸ‡ªğŸ‡¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…\nğŸ’³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: ${document.getElementById('i_method').value}\nğŸ¦ Ø§Ù„Ù…Ø­ÙØ¸Ø©: ${document.getElementById('i_wallet').value}\nâ° ${d}`;
        const fd = new FormData(); fd.append('chat_id', c.chatid); fd.append('photo', f); fd.append('caption', msg);
        await fetch(`https://api.telegram.org/bot${c.token}/sendPhoto`, { method: 'POST', body: fd });
        alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…"); location.reload();
    }
</script>
</body>
</html>
